<!--
 - Created by Igor Malyuta on 24.12.2019.
 -->

<!-- Message Board -->
<template>
    <template if:true={hideEmptyStub}>
        <div class="ms-board" data-gtm="ms-board">
            <div class="ms-board-header">
                <template if:true={isMultipleMode}>
                    <div class="ms-multi-header">
                        <template if:false={isPIMode}>
                            <div class="ms-multi-header-pa">
                                <div class="ms-pi-new-mess">{labels.newMessLabel}</div>
                                <lightning-combobox
                                        data-gtm="ms-pa-pe-select"
                                        style="flex-basis: 60%;"
                                        label=""
                                        variant="label-hidden"
                                        value={selectedPeId}
                                        placeholder={labels.selectStudyPlaceholderLabel}
                                        options={enrollmentsOptions}
                                        onchange={handleEnrollmentSelect}></lightning-combobox>
                            </div>
                        </template>
                        <template if:true={isPIMode}>
                            <!-- Search input by PE (Participants Name) -->
                            <div class="ms-multi-header-pi">
                                <div class="ms-pi-new-mess">{labels.newMessLabel}</div>
                                <div class="ms-pi-multi-recipient" data-gtm="LKP_Participants">
                                    <c-web-lookup
                                            onsearch={handleSearch}
                                            onselectionchange={handleSelectionChange}
                                            placeholder={labels.recipientsPlaceholder}
                                            is-multi-entry="true">
                                    </c-web-lookup>
                                </div>
                            </div>
                        </template>
                    </div>
                </template>
                <template if:false={isMultipleMode}>
                    <div class="ms-single-header">
                        <template if:false={isPIMode}>
                            <div class="ms-header-team-name" data-gtm="ms-header-name-pa">
                                <template if:false={isPastStudy}>
                                    {labels.teamLabel}&nbsp;|&nbsp;{labels.piLabel}&nbsp;{selectedEnrollment.Study_Site__r.Principal_Investigator__r.Name}
                                </template>
                                <template if:true={isPastStudy}>
                                    <c-web-limit-text-by-lines max-lines="2"
                                                               title={selectedEnrollment.Clinical_Trial_Profile__r.Study_Code_Name__c}>
                                        <span slot="body">{labels.teamLabel}&nbsp;|&nbsp;{selectedEnrollment.Clinical_Trial_Profile__r.Study_Code_Name__c}</span>
                                    </c-web-limit-text-by-lines>
                                </template>
                            </div>
                        </template>
                        <template if:true={isPIMode}>
                            <div class="ms-header-patient-name"
                                 data-gtm="ms-header-patient-name">{selectedEnrollment.Participant__r.Full_Name__c}
                            </div>
                            <div class="ms-header-patient-study" data-gtm="ms-header-patient-study">
                                <c-web-limit-text-by-lines max-lines="1"
                                                           title={selectedEnrollment.Clinical_Trial_Profile__r.Study_Code_Name__c}>
                                    <span slot="body">{selectedEnrollment.Clinical_Trial_Profile__r.Study_Code_Name__c}</span>
                                </c-web-limit-text-by-lines>
                            </div>
                        </template>
                    </div>
                </template>
            </div>
            <div class="ms-board-body" data-gtm="ms-board-body">
                <template if:true={messageWrappers}>
                    <template for:each={messageWrappers} for:item="msWr">
                        <c-message-item key={msWr.message.Id} item={msWr} user-mode={userMode}></c-message-item>
                    </template>
                </template>
            </div>
            <div class="ms-board-footer">
                <template if:true={isPIMode}>
                    <div class="ms-send-pi">
                        <lightning-input data-gtm="ms-pi-input"
                                         type="text" label="" variant="label-hidden"
                                         max-length="500"
                                         placeholder={labels.inputPlaceholderLabel}
                                         value={messageText}
                                         onchange={handleMessageText}
                                         onkeypress={handleInputEnter}></lightning-input>
                        <div class="ms-send-pi-buttons">
                            <div style="flex-grow: 1;">{labels.limitLabel}</div>

                            <template if:true={conversation}>
                                <div class="slds-form-element" style="margin: 0 12px;">
                                    <div class="slds-form-element__control">
                                        <div class="slds-file-selector slds-file-selector_files">
                                            <label class="slds-file-selector__body">
                                                <template if:true={isSendEnable}>
                                                    <lightning-file-upload
                                                            style="opacity: 0; position: fixed"
                                                            label=""
                                                            name="fileUploader"
                                                            accept={fileTypes}
                                                            record-id={conversation.Id}
                                                            onuploadfinished={handleUploadFinished}></lightning-file-upload>
                                                </template>
                                                <span class="slds-file-selector__button slds-button">
                                                    <span class="apollo-btn secondary ms-att-file-label" onclick={handleTMP}>{labels.attFileLabel}</span>
                                                    <span class="ms-att-file-icon" onclick={handleTMP}>
                                                        <c-web-icon icon-name="attachment" icon-color="#297DFD"></c-web-icon>
                                                    </span>
                                                </span>
                                            </label>
                                        </div>
                                    </div>
                                </div>
                            </template>

                            <button data-gtm="ms-send-pi-button" class="apollo-btn primary ms-send-button"
                                    onclick={handleSendClick} disabled>{labels.sendBtnLabel}
                            </button>
                        </div>
                    </div>
                </template>
                <template if:false={isPIMode}>
                    <div class="ms-send-part">
                        <lightning-combobox
                                style="flex-basis: 85%;"
                                data-gtm="ms-pa-select"
                                label={labels.selectLabel}
                                value={messageText}
                                placeholder={labels.selectPlaceholderLabel}
                                options={messageTemplateOptions}
                                onchange={handleMessageText}></lightning-combobox>
                        <button class="apollo-btn primary ms-send-button" data-gtm="ms-send-pa-button"
                                onclick={handleSendClick} disabled>{labels.sendBtnLabel}
                        </button>
                    </div>
                </template>
            </div>
        </div>
    </template>
    <template if:false={hideEmptyStub}>
        <div class="ms-empty-chat" data-gtm="ms-empty-chat">
            <c-web-icon icon-name="messages-bubble-square" icon-color="#a6a6a6" icon-width="40" icon-height="36"
                        style="padding-top: 32px;"></c-web-icon>
            <div class="ms-empty-chat-label">{labels.emptyChatLabel}</div>
        </div>
    </template>
</template>