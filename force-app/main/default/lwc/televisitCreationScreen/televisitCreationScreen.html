<template>
    <br/>
    <div class="slds-grid slds-wrap">
        <div class="slds-col slds-size_6-of-12">
            <lightning-layout>
                <lightning-layout-item class="slds-col slds-size_1-of-8">
                View:
                </lightning-layout-item>
                <lightning-layout-item class="slds-col slds-size_7-of-8">
                    <lightning-combobox
                        value={value}
                        options={options}
                        onchange={handleChange}
                        style="width:210px;margin-top:-25px;"
                    >
                    </lightning-combobox>
                </lightning-layout-item>
            </lightning-layout>
        </div>
        <div class="slds-col slds-size_6-of-12">
            <lightning-button 
                label="Create Televisit"
                title="Create Televisit"
                onclick={openModal}
                class="slds-m-left_x-small slds-float_right">
            </lightning-button>
        </div>
    </div>
    
    <template if:true={isModalOpen}>
        <section role="dialog" tabindex="-1" aria-labelledby="modal-heading-01" aria-modal="true"
        aria-describedby="modal-content-id-1" class="slds-modal slds-modal_small slds-align--absolute-center slds-fade-in-open">
        <div class="slds-modal_small">
           <div class="slds-modal__container model-small" >
              <div class="slds-modal__content" id="modal-content-id-1">
                <div class="bar"></div>
                 <div class="slds-p-around_large" style="margin:0px 15px 0px 15px;">
                    <div class="slds-grid slds-gutters close-arrow-left slds-m-bottom_small">
                       <div class="slds-col slds-large-size_11-of-12 slds-medium-size_11-of-12 slds-size_10-of-12">
                          <span class="title" style="font-weight:700;font-size:20px">Create Televisit</span> 
                       </div>
                       <div class="slds-col slds-size_1-of-12 close-icon">
                          <div onclick={closeModal}>
                            <button class="closeButtopnIcon slds-button slds-button_icon slds-modal__close slds-button_icon-inverse slds-float_right" title="Close" onclick={closeModal}>
                                <lightning-icon icon-name="utility:close"
                                    alternative-text="close"
                                    size="x-small" ></lightning-icon>
                                <span class="slds-assistive-text">Close</span>
                            </button>
                          </div>
                       </div>
                    </div>
                    <slot name="body">
                        <div class="slds-grid slds-wrap">
                            <div class="slds-col slds-size_12-of-12">
                                <abbr class="slds-required">*</abbr>
                                <label class="inputFields">Title</label>
                                <lightning-input class="inputFields" variant="label-hidden"  data-id="Title"  value={title} name="Title" onchange={handleChangeValidation} type="text" label="Title" title="Title" placeholder="Enter Title"></lightning-input>
                            </div>
                        </div>
                        <br/>
                        <div class="slds-grid slds-wrap">
                            <div class="slds-col slds-size_4-of-12 slds-p-right_small">
                                <abbr class="slds-required">*</abbr>
                                <label class="inputFields">Visit Date</label>
                                <lightning-input variant="label-hidden"  min={today} class="inputFields" name="Visit Date" data-id="Visit Date" value={visitDate} onchange={handleChangeValidation} type="date" placeholder="mm/dd/yyyy" label="Visit Date"></lightning-input>
                                <!--<input onchange={handleChangeValidation} class="slds-input inputFields" type="date" data-id="Visit Date" name="Visit Date" value={visitDate} min={today} max="2122-01-02" placeholder="mm/dd/yyyy">-->
                            </div>
                            <div class="slds-col slds-size_4-of-12 slds-p-right_small">
                            
                                <abbr class="slds-required">*</abbr>
                                <label class="inputFields">Start Time</label>
                                    <lightning-input  class="inputFields" name="Start Time" data-id="Start Time" type="time" data-value="Start Time" onchange={handleChangeValidation}
                                        variant="label-hidden"
                                        value={startTime}
                                        label="Start Time"
                                        title="Start Time" min="05:00:00.000Z" max="23:45:00.000Z" placeholder="Select Time">
                                    </lightning-input>
                            
                            </div>
                            <div class="slds-col slds-size_4-of-12">
                                <abbr class="slds-required">*</abbr>
                                <label class="inputFields">Duration</label>
                                &nbsp;
                                <div class="tooltip"> 
                                    <lightning-icon icon-name="utility:info" size="x-small"></lightning-icon>
                                    <span class="tooltiptextBottom ">Call will be ended after the planned duration time</span> 
                                </div>
                                <lightning-combobox
                                        name="Duration"
                                        label="Duration"
                                        value={duration}
                                        options={durations}
                                        onchange={handleChangeValidation}
                                        placeholder="Select Duration"
                                        data-id="Duration"
                                        variant="label-hidden"
                                        class="inputFields"
                                    >
                                    </lightning-combobox>
                                    
                                
                            </div>
                        </div>
                        <br/>
                        <div class="slds-grid slds-wrap">
                            <div class="slds-col slds-size_12-of-12">
                                <span class="inputFields">Attendees</span> 
                                <c-multi-lookup data-id="Attendee" name="Attendee" options={attendeesList} place-holder="Search to add" 
                				onoptionchange={handleAttendeeChange}></c-multi-lookup>
                            </div>
                        </div>
                        <br/>
                        <br/>
                        <br/>
                        <div class="slds-grid slds-wrap slds-m-top_large">
                          <div class="slds-col slds-size_1-of-1 slds-medium-size_12-of-12 slds-large-size_12-of-12">
                            <div class="slds-float_right mobile-width">  
                                <button class="slds-button apollo-btn secondary btn-height discard-btn"  onclick={closeModal}> Discard</button>                
                                <template if:false={televisitEditView}>
                                    <button title="" class="slds-button apollo-btn primary btn-height save-btn"  onclick={submitDetails} disabled={disableSaveButton}> Save </button>
                                </template>
                                <template if:true={televisitEditView}>
                                    <button title="" class="slds-button apollo-btn primary btn-height save-btn"  onclick={submitDetails} disabled={disableSaveButton}> Update </button>
                                </template>
                            </div>    
                          </div>
                       </div>
                    </slot>
                 </div>
              </div>
           </div>
        </div>
     </section>
     <div class="slds-backdrop slds-backdrop_open"></div>
 
    </template> 

    
    <template if:true={displayTelevisitRecords}>
        <div  class="slds-col slds-max-small-size_1-of-1 slds-size--1-of-1 vertical-scroll" style="font-size:15px;">
            
        <template for:each={televisitRecordsList} for:item="tv">
            <div key={tv.id} class="lightningCard">
                
                <lightning-card key={tv.id}>
                    <lightning-layout >
                        <lightning-layout-item padding="horizontal-small" style="margin-top:-10px;margin-bottom:1px;" size="8" >
                            <lightning-formatted-text style="font-size: 16px;" value={tv.title}></lightning-formatted-text>&nbsp;
                            <template if:true={tv.isCancelledStatus}>
                                <lightning-formatted-text style="font-size: 14px;" value={tv.status}></lightning-formatted-text>
                            </template>
                            
                        </lightning-layout-item>
                        <lightning-layout-item size="3">
                            <lightning-layout >
                                <lightning-layout-item padding="around-small" style="display:none;">
                                    <template if:true={tv.meetingUrl} >
                                        <button class="slds-button apollo-btn primary save-btn" style=" margin-top: -20px;margin-right: 15px;" value={tv.meetingUrl}  onclick={openTelevisitWindow}> Join </button>
                                    </template>
                                </lightning-layout-item>
                            </lightning-layout>
                        </lightning-layout-item>
                        <lightning-layout-item size="1" style=" margin-top: -20px;">
                            <lightning-layout >
                                <lightning-layout-item padding="around-small" >
                                    <lightning-button-menu onselect={handleOnselect} menu-alignment="auto" >
                                        <lightning-menu-item value="Edit" label="Edit" data-id={tv.id} data-title={tv.title} data-visitdate={tv.visitDate} data-starttime={tv.startTime} data-duration={tv.duration}  onclick={openModal}></lightning-menu-item>
                                        <lightning-menu-item value="Cancel" label="Cancel" data-id={tv.id} onclick={openCancelModal}></lightning-menu-item>
                                        
                                    </lightning-button-menu>
                                </lightning-layout-item>
                            </lightning-layout>
                        </lightning-layout-item>
                    </lightning-layout>
                    <lightning-layout multiple-rows="true">
                        <lightning-layout-item size="12" style="margin-top:-10px">    
                            <lightning-layout >
                                <lightning-layout-item padding="horizontal-small">
                                    <lightning-icon icon-name="utility:event"
                                        alternative-text="event"
                                        size="small" >
                                    </lightning-icon>
                                </lightning-layout-item>
                                <lightning-layout-item class="slds-p-right_x-small">
                                    <lightning-formatted-date-time value={tv.visitDate} >
                                    </lightning-formatted-date-time>,
                                </lightning-layout-item>
                                <lightning-layout-item class="slds-p-right_x-small">
                                    <lightning-formatted-date-time time-zone="UTC" value={tv.startTime} hour="2-digit" minute="2-digit" hour12="false" >
                                    </lightning-formatted-date-time>
                                </lightning-layout-item>
                                <lightning-layout-item>
                                    (<lightning-formatted-text value={tv.duration}></lightning-formatted-text>)
                                </lightning-layout-item>
                            </lightning-layout>
                        </lightning-layout-item>
                        
                        <lightning-layout-item padding="around-small" size="12">
                            <lightning-layout-item >
                                <lightning-icon icon-name="utility:user"
                                    alternative-text="user"
                                    size="small" class="slds-p-right_x-small">
                                </lightning-icon>
                            </lightning-layout-item>
                            <lightning-layout-item class="slds-p-right_x-small">
                                <template for:each={tv.attendeesList} for:item="attendee" >
                                    {attendee.Firstname__c} {attendee.Lastname__c} ({attendee.Attendee_Type__c}),&nbsp;
                                </template>
                            </lightning-layout-item>
                        </lightning-layout-item>
                            
                        

                    </lightning-layout>
                    
                
                    


                    
                    
                    
                    
                    
                    
                </lightning-card>
                
            </div>
        </template>
    </div>
    </template>
    <template if:true={isCancelModalOpen}>
        <section role="dialog" tabindex="-1" aria-labelledby="modal-heading-01" aria-modal="true"
        aria-describedby="modal-content-id-1" class="slds-modal slds-modal_small slds-align--absolute-center slds-fade-in-open">
        <div class="slds-modal_small">
           <div class="slds-modal__container model-small">
              <div class="slds-modal__content">
                <div class="bar"></div>
                 <div class="slds-p-around_large">
                    <div class="slds-grid slds-gutters close-arrow-left slds-m-bottom_small">
                       <div class="slds-col slds-large-size_11-of-12 slds-medium-size_11-of-12 slds-size_10-of-12">
                          <span class="title" style= "font-size:16px; font-weight:500;">Televisit record will get cancelled. Do you need to proceed further?</span> 
                       </div>
                       <div class="slds-col slds-size_1-of-12 close-icon">
                          <div onclick={handleCloseModal}>
                             <lightning-icon icon-name="utility:close"
                                alternative-text="close"
                                size="x-small" ></lightning-icon>
                             <span class="slds-assistive-text">Close</span>
                          </div>
                       </div>
                    </div>
                    <slot name="body">
                       <p class="sub-text"></p>
                       <div class="slds-grid slds-wrap slds-m-top_large">
                          <div class="slds-col slds-size_1-of-1 slds-medium-size_12-of-12 slds-large-size_12-of-12">
                            <div class="slds-float_right mobile-width">                  
                                <button title="" class="slds-button apollo-btn primary btn-height save-btn" data-id={cancelTelevisitRecordId}  onclick={cancelTelevisit}> Yes </button>
                                <button class="slds-button apollo-btn secondary btn-height discard-btn"  onclick={handleCloseModal}> No </button>
                            </div>    
                          </div>
                       </div>
                    </slot>
                 </div>
              </div>
           </div>
        </div>
     </section>
     <div class="slds-backdrop slds-backdrop_open"></div>
     </template>

    
 </template>