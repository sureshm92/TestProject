<!--
 - Created by Nikita Abrazhevitch on 05-Sep-19.
 -->

<aura:component description="Action_ParticipantInformation" controller="ParticipantInformationRemote">
    <ltng:require scripts="{!join(',', $Resource.rr_community_js)}" afterScriptsLoaded="{!c.doInit}"/>

    <!-- attributes: -->
    <aura:attribute name="pe" type="Participant_Enrollment__c"/>
    <aura:attribute name="participant" type="Participant__c" access="private"/>
    <aura:attribute name="callback" type="Object" access="private"/>
    <aura:attribute name="rootComponent" type="Aura.Component" access="public"/>
    <aura:attribute name="formData" type="AddPatientByPIRemote.FormData" access="private"/>
    <aura:attribute name="initialized" type="Boolean" default="false" access="private"/>
    <aura:attribute name="isFinalUpdate" type="Boolean"/>
    <aura:attribute name="isValid" type="Boolean" default="false"/>
    <aura:attribute name="saveAndChangeStep" type="Boolean" default="false"/>
    <aura:attribute name="popUpTitle" type="String"/>
    <aura:attribute name="pathItems" type="List"/>
    <aura:attribute name="statusSteps" type="List" access="public"/>
    <aura:attribute name="anchor" type="String"/>
    <aura:attribute name="modifiedSteps" type="List"/>
    <aura:attribute name="refreshForm" type="Boolean" default="false"/>
    <aura:attribute name="refreshSteps" type="Boolean" default="false"/>
    <aura:attribute name="actions" type="Object"/>
    <aura:attribute name="currentTab" type="String" default="by-study"/>
    <aura:attribute name="checkTabs" type="String" default="participantDetails"/>
    <aura:attribute name="isInvited" type="Boolean" access="public"/>
    <aura:attribute name="sendEmails" type="Boolean" default="false"/>
    <aura:attribute name="participantPath" type="Object"/>


    <!-- methods -->
    <aura:method name="execute" action="{!c.doExecute}" access="public">
        <aura:attribute name="pe" type="Participant_Enrollment__c"/>
        <aura:attribute name="pathItems" type="List"/>
        <aura:attribute name="anchorScroll" type="String"/>
        <aura:attribute name="actions" type="Object"/>
        <aura:attribute name="rootComponent" type="Aura.Component" access="public"/>
        <aura:attribute name="isInvited" type="Boolean" access="public"/>
        <aura:attribute name="callback" type="Function"/>
    </aura:method>
    <aura:method name="doCallback" action="{!c.doCallback}" access="public"/>
    <aura:method name="doUpdate" action="{!c.doUpdate}" access="public"/>
    <aura:method name="doUpdatePatientStatus" action="{!c.doUpdatePatientStatus}" access="public"/>

    <aura:handler name="change" value="{!v.pathItems}" action="{!c.prepareEditableSteps}"/>

    <!-- component body: -->
    <c:Popup aura:id="dialog" title="{!v.popUpTitle}" size="large" showScroll="true" showHeader="true" showFooter="true">
        <aura:if isTrue="{!!v.isInvited}">
            <div class="invite-patient-container slds-grid slds-grid--vertical-align-center slds-size--1-of-1 slds-wrap">
                <div class="slds-col slds-size--9-of-12 slds-max-small-size--1-of-1 slds-grid slds-grid--vertical-align-center">
                    <lightning:input type="checkbox" class="invite-patient-checkbox" checked="{!v.sendEmails}"/>
                    <div class="slds-size--10-of-12">{!$Label.c.Send_Emails_Checkbox_on_PE_Info}</div>
                </div>
                <button class="slds-col slds-size--3-of-12 slds-max-small-size--1-of-1 apollo-btn secondary slds-float_right slds-grid--vertical-align-center"
                onclick="{!c.createUserForPatient}" data-gtm="BTN_Invite_To_PP">{!$Label.c.BTN_Create_User_on_PE_Info}</button>
            </div>
        </aura:if>
        <c:RRSpinner aura:id="spinner" size="medium"/>
        <div class="form-content" data-gtm="Tabs_View_Details" id="anchor">
            <aura:if isTrue="{!v.initialized}">

            <lightning:tabset>
                <lightning:tab class="slds-tabs_default__item" aura:id="participantDetails"  label="{!$Label.c.BTN_Participant_Details}" onactive="{!c.checkTabs}">
                <div class="personal-info-container" id="personalInfoAnchor">
                    <c:Form_EditPatientInfo aura:id="editForm" fromActionParticipant="true" participant="{!v.participant}" pe="{!v.pe}"
                                            formData="{!v.formData}"
                                            updateMode="true"
                                            isValid="{!v.isValid}"
                                            visitPlanRequired="{!v.pe.Study_Site__r.Clinical_Trial_Profile__r.Patient_Portal_Enabled__c}"/>
                </div>
                </lightning:tab>
                <lightning:tab aura:id="Status" label="{!$Label.c.BTN_Status_Details}" onactive="{!c.checkTabs}">
                    <c:ParticipantStatusDetails participantWorkflowWrapper="{!v.participantPath}" parent="{!this}"/>
                </lightning:tab>
                <lightning:tab class="slds-tabs_default__item" aura:id="Provider" label="{!$Label.c.Tab_HealthCare_Provider}" title="{!$Label.c.Tab_HealthCare_Provider}" onactive="{!c.checkTabs}">
                    <aura:if isTrue="{!v.pe}">
                        <div id="healthCareProvider">
                            <c:ReferHealthcareProvider pe="{!v.pe}" refProvider="{!v.pe.HCP__r.HCP_Contact__r}" showReferringProvider="{!v.pe.Show_Referring_Provider__c}" fromActionParticipant="true" actionDisabled="{!v.actions.screenerResponses.disabled}"/>
                        </div>
                    </aura:if>
                </lightning:tab>
                <aura:if isTrue="{!v.pe.MRR_Survey_Results_URL__c &amp;&amp; !v.actions.screenerResponses.disabled}">
                <lightning:tab class="slds-tabs_default__item" aura:id="Survey" label="{!$Label.c.BTN_Screener_Responses}" onactive="{!c.checkTabs}">
                        <c:SurveyGismoResultsView results="{!v.pe.MRR_Survey_Results_URL__c}"/>
                </lightning:tab>
            </aura:if>
            </lightning:tabset>
            </aura:if>
        </div>
            <!--<aura:set attribute="headerButtons">
                <lightning:button onclick="{!c.doPrint}" name="Print" class="{!'slds-button slds-button&#45;&#45;icon-inverse'}">
                    <c:RRIcon iconName="icon-print" class="print-icon"/>
                </lightning:button>
            </aura:set>-->
            <aura:set attribute="footerButtons">
                <div data-gtm="BTNS_Popup_Save_Cancel">
                <lightning:button class="apollo-btn secondary slds-float_right slds-button--neutral" disabled="{!!v.isValid}" onclick="{!c.doUpdateCancel}">{!$Label.c.BTN_Save_All_Tabs}</lightning:button>
                <aura:if isTrue="{!v.checkTabs == 'participantDetails'}">
                <lightning:button class="apollo-btn secondary slds-float_left" disabled="{!!v.isValid}" onclick="{!c.doUpdate}">{!$Label.c.PG_MTI_BTN_Save_Changes}</lightning:button>
                </aura:if>
                <lightning:button class="apollo-btn secondary slds-float_right slds-button--reset" onclick="{!c.doCancel}">{!$Label.c.BTN_Cancel}</lightning:button>
                </div>
            </aura:set>
    </c:Popup>
</aura:component>
