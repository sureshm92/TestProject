<!--
 - Created by Leonid Bartenev
 -->

<aura:component description="ViewPatientItem" controller="ReferralProfileRemote" extends="c:CommunityContext">
    <ltng:require styles="{!join(',', $Resource.rr_community_css, $Resource.proximanova + '/proximanova.css')}"
                  scripts="{!join(',', $Resource.rr_community_js)}"/>

    <!-- attributes: -->
    <aura:attribute name="pe" type="Object" description="Participant enrollment item"/>
    <aura:attribute name="actions" type="Object"/>
    <aura:attribute name="userMode" type="String"/>
    <aura:attribute name="parent" type="Aura.Component"/>
    <aura:attribute name="peStatusesPathList" type="List"/>
    <aura:attribute name="peStatusStateMap" type="Map"/>
    <aura:attribute name="pathItems" type="List"/>
    <aura:attribute name="showPath" type="Boolean"/>
    <aura:attribute name="peAdditionalName" type="String"/>
    <aura:attribute name="singlePatientView" type="Boolean" default="false"/>
    <aura:attribute name="detailCollapsed" type="Boolean" default="true"/>
    <aura:attribute name="changeStatusBtnList" type="List"/>
    <aura:attribute name="isInvited" type="Boolean"/>
    <aura:attribute name="trial" type="Object"/>
    <aura:attribute name="frameHeight" type="String" default="500px"/>


    <!-- handlers: -->
    <aura:handler name="init" value="{!this}" action="{!c.doInit}"/>
    <aura:handler name="change" value="{!v.pe}" action="{!c.doInit}"/>
    <aura:handler name="change" value="{!v.detailCollapsed}" action="{!c.doLoadHistoryOnOpen}"/>

    <!-- component body: -->
    <div class="{!'rr-white-panel padding ' + if(v.isArabic, ' rtl', '')}" style="position: relative">
        <c:RRSpinner aura:id="spinner" size="small" showSpinner="true"/>
        <aura:if isTrue="{!empty(v.pe)}">
            <div style="height: 250px"></div>
        </aura:if>
        <aura:if isTrue="{!!empty(v.pe)}">
            <c:ParticipantCardHeader userMode="{!v.userMode}" pe="{!v.pe}" isReferral="false"/>
            <c:ParticipantCardFields userMode="{!v.userMode}" isInvited="{!v.isInvited}" pe="{!v.pe}"/>
            <aura:if isTrue="{!v.showPath}">
                <div class="vpi-path-panel">
                    <div class="{!v.userMode != 'PI' ? 'path-section' : 'path-section-pi'}">
                        <div class="slds-grid vpi-path">
                            <aura:iteration items="{!v.pathItems}" var="pathItem">
                                <div class="{!'slds-col width-basis vpi-state ' + pathItem.state + if(pathItem.isCurrent, ' current', '')}">
                                    <div class="slds-grid">
                                        <div class="{!'slds-col width-basis vpi-line-div ' + pathItem.left}"></div>
                                        <div class="{!'slds-col width-basis vpi-line-div ' + pathItem.right}"
                                             style="position: relative">
                                            <div class="state-ico-wrapper">
                                                <aura:if isTrue="{!pathItem.state == 'success'}">
                                                    <c:RRIcon iconName="icon-check"/>
                                                </aura:if>
                                                <aura:if isTrue="{!pathItem.state == 'failure'}">
                                                    <c:RRIcon iconName="icon-close"/>
                                                </aura:if>
                                                <aura:if isTrue="{!pathItem.state == 'in_progress'}">
                                                    <c:RRIcon iconName="icon-minus"/>
                                                </aura:if>
                                                <aura:if isTrue="{!pathItem.state == 'neutral'}">
                                                    <c:RRIcon iconName="icon-minus"/>
                                                </aura:if>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="vri-state-label">{!pathItem.name}</div>
                                </div>
                            </aura:iteration>
                        </div>
                    </div>
                </div>

                <aura:if isTrue="{!v.userMode == 'PI'}">
                    <div class="slds-grid vpi-status-btns slds-gutters_x-small slds-wrap">
                        <!--<div class="{!v.pe.MRR_Survey_Results_URL__c &amp;&amp; !v.actions.screenerResponses.disabled ? 'slds-col slds-size_1-of-1 slds-small-size_4-of-12' : 'slds-col slds-size_1-of-1 slds-small-size_4-of-12'}">
                            <button class="{!'apollo-btn secondary'}"
                                    title="{!$Label.c.BTN_Participant_Information}"
                                    onclick="{!c.showEditParticipantInformation}"
                                    value="personalInfoAnchor">
                                {!$Label.c.BTN_Participant_Information}
                            </button>
                        </div>
                        <div class="{!v.pe.MRR_Survey_Results_URL__c &amp;&amp; !v.actions.screenerResponses.disabled ? 'slds-col slds-size_1-of-1 slds-small-size_4-of-12' : 'slds-col slds-size_1-of-1 slds-small-size_4-of-12'}">
                            <button class="{!'apollo-btn secondary'}"
                                    title="{!$Label.c.BTN_HealthCare_Providers}"
                                    onclick="{!c.showEditParticipantInformation}"
                                    value="healthCareProvider">
                                {!$Label.c.BTN_HealthCare_Providers}
                            </button>
                        </div>-->
                        <div class="{!v.pe.MRR_Survey_Results_URL__c &amp;&amp; !v.actions.screenerResponses.disabled ? 'slds-col slds-size_1-of-1 slds-small-size_6-of-12' : 'slds-col slds-size_1-of-1 slds-small-size_4-of-12'}">
                            <button class="{!'apollo-btn secondary'}"
                                    title="{!$Label.c.BTN_View_Participant_Details}"
                                    onclick="{!c.showEditParticipantInformation}"
                                    value="statusDetailsAnchor">
                                {!$Label.c.BTN_View_Participant_Details}
                            </button>
                        </div>
                        <!--<aura:if
                                isTrue="{!v.pe.MRR_Survey_Results_URL__c &amp;&amp; !v.actions.screenerResponses.disabled}">
                            <div class="{!v.pe.MRR_Survey_Results_URL__c &amp;&amp; !v.actions.screenerResponses.disabled ? 'slds-col slds-size_1-of-1 slds-small-size_4-of-12' : 'slds-col slds-size_1-of-1 slds-small-size_4-of-12'}">
                                <button class="{!'apollo-btn secondary'}"
                                        iconPosition="right"
                                        data-gtm="BTN_CheckScreener"
                                        title="{!$Label.c.BTN_Screener_Responses}"
                                        onclick="{!c.showEditParticipantInformation}"
                                        value="screenerResponsesAnchor">
                                    {!$Label.c.BTN_Screener_Responses}
                                    <c:RRIcon class='slds-icon' color="white"
                                              iconName="{!v.pe.Pre_screening_Status__c == 'Pass' ? 'icon-check-circle' : 'icon-minus-circle'}"/>
                                </button>
                            </div>
                        </aura:if>-->
                        <aura:if
                                isTrue="{!empty(v.pe.MRR_Survey_Results_URL__c) &amp;&amp; !v.actions.screenerResponses.disabled}">
                            <div class="slds-col slds-size_1-of-1 slds-small-size_4-of-12">
                                <lightning:button class="slds-button--neutral"
                                                  title="{!$Label.c.BTN_Screener_Participant}"
                                                  onclick="{!c.doPreScreening}">
                                    {!$Label.c.BTN_Screener_Participant}
                                </lightning:button>
                            </div>
                        </aura:if>
                    </div>
                </aura:if>
                <aura:if isTrue="{!and(v.userMode == 'PI', v.pe.Participant_Status__c == 'Referral Sent to PI')}">
                    <div class="slds-grid vpi-status-btns slds-wrap">
                        <aura:iteration items="{!v.changeStatusBtnList}" var="btn">
                            <button class="{!'apollo-btn secondary'}"
                                    disabled="{!v.actions.changePEStatusByPI.disabled}"
                                    title="{!v.actions.changePEStatusByPI.disableReason}"
                                    data-status-name="{!btn.status}"
                                    onclick="{!c.doChangeStatus}">
                                {!btn.name}
                            </button>
                        </aura:iteration>
                    </div>
                </aura:if>

                <aura:if
                        isTrue="{!and(!v.showPath, !and(v.userMode == 'PI', v.pe.Participant_Status__c == 'Referral Sent to PI'))}">
                    <div>
                        <c:ParticipantStatus pEnrollment="{!v.pe}"/>
                    </div>
                </aura:if>
            </aura:if>
        </aura:if>
    </div>
</aura:component>