<template>
    <!-- Loading Spinner-->
    <c-web-spinner class="main-spinner" fixed="true"></c-web-spinner>
    <div class={cardRTL}>
        <div>
            <lightning-layout multiple-rows="true">
                <lightning-layout-item class="slds-p-vertical_small" size="12">
                    <div class="tasks">{label.tasksHeader}</div>
                </lightning-layout-item>
                <lightning-layout-item padding="around-small" size="12">
                    <div class="page-section page-header">
                        <div class="slds-align_absolute-center">
                            <button class="open-task">Open</button
                            ><button class="completed-task">Completed</button>
                        </div>
                    </div>
                </lightning-layout-item>
                <lightning-layout-item padding="around-small" size="12">
                    <template if:true={showCreateTaskButton}>
                        <div class="slds-align_absolute-center">
                            <button class={taskButtonClass} onclick={doCreateTask}>
                                <span
                                    ><lightning-icon
                                        icon-name="utility:add"
                                        size="x-small"
                                        class="plus-icon"
                                    >
                                    </lightning-icon
                                ></span>
                                <span>{label.createNewTask}</span>
                            </button>
                        </div>
                    </template>

                    <template if:true={isCreateTask}>
                        <c-pp-create-task ontaskclose={handleTaskClose}></c-pp-create-task>
                    </template>
                </lightning-layout-item>
                <lightning-layout-item padding="around-small" size="12">
                    <template if:true={isShowModal}>
                        <section
                            role="dialog"
                            tabindex="-1"
                            aria-labelledby="modal-heading-01"
                            aria-modal="true"
                            aria-describedby="modal-content-id-1"
                            class="slds-modal slds-fade-in-open"
                        >
                            <div
                                class="slds-modal__container completemask"
                                data-modalpopup={popUpTaskId}
                            >
                                <div class="completemaskmargin">
                                    <lightning-layout>
                                        <lightning-layout-item
                                            ><div class="modaltitle">
                                                Mark as Complete
                                            </div></lightning-layout-item
                                        >
                                        <lightning-layout-item
                                            style="margin-left: 5rem; margin-top: 2rem"
                                        >
                                            <lightning-icon
                                                icon-name="utility:close"
                                                size="small"
                                                onclick={closeModel}
                                            >
                                            </lightning-icon></lightning-layout-item
                                    ></lightning-layout>

                                    <div class="modalbody">
                                        You are about to mark this task as complete. Are you sure
                                        you would like to continue?
                                        <!-- <a >Cancel</a>
                                        <button class="modalbutton">Confirm</button>-->
                                        <lightning-layout style="float: right; margin-right: -1rem">
                                            <lightning-layout-item
                                                style="margin-top: 2.5rem; margin-right: 1rem"
                                            >
                                                <a onclick={closeModel}>Cancel</a>
                                            </lightning-layout-item>
                                            <lightning-layout-item
                                                style="margin-top: 2.2rem; margin-right: 1rem"
                                            >
                                                <button class="modalbutton" onclick={closeTheTask}>
                                                    Confirm
                                                </button>
                                            </lightning-layout-item>
                                        </lightning-layout>
                                    </div>
                                </div>
                                <!-- modal header start -->

                                <!-- modal body start 
                                <div
                                    class="slds-modal__content completemask"
                                    id="modal-content-id-1"
                                > -->

                                <!--<button
                                        class="slds-button slds-button_neutral"
                                        onclick={closeTheTask}
                                    >
                                        Confirm
                                    </button>
                                </div> -->
                            </div>
                        </section>
                    </template>
                    <template for:each={openTasks} for:item="item" for:index="index">
                        <div key={item} class="inactive-custom-box slds-align_absolute-center">
                            <lightning-layout-item size="2">
                                <template if:true={item.systemTask}>
                                    <div
                                        class="slds-p-around_medium"
                                        onclick={taskOpen}
                                        data-actionurl={item.openTask.Action_URL__c}
                                        data-index={item.openTask.Id}
                                    >
                                        <img src={systemTaskImg} class="systask" />
                                    </div>
                                </template>
                                <template if:false={item.systemTask}>
                                    <div
                                        class="slds-p-around_medium"
                                        onclick={showTaskCompleteModal}
                                        data-index={item.openTask.Id}
                                    >
                                        <template if:false={item.isClosed}>
                                            <img src={openTaskImg} class="opentask" />
                                        </template>
                                        <template if:true={item.isClosed}>
                                            <img src={closeTaskImg} class="opentask" />
                                        </template>
                                    </div>
                                </template>
                            </lightning-layout-item>
                            <lightning-layout-item size="8" padding="around-small">
                                <div class="slds-p-around_medium">
                                    <div class="set-up-your-account">
                                        <lightning-formatted-text value={item.openTask.Subject}>
                                        </lightning-formatted-text>
                                    </div>
                                    <div class="duetime">
                                        Due : &nbsp;
                                        <template if:true={item.dueDate}>
                                            <lightning-formatted-date-time
                                                value={item.openTask.activityDate}
                                                year="numeric"
                                                month="short"
                                                day="2-digit"
                                            ></lightning-formatted-date-time
                                        ></template>
                                        <template if:true={item.startDate}
                                            ><lightning-formatted-date-time
                                                value={item.openTask.Start_Date__c}
                                                year="numeric"
                                                month="short"
                                                day="2-digit"
                                            ></lightning-formatted-date-time
                                        ></template>
                                        <template if:true={item.createdDate}
                                            ><lightning-formatted-date-time
                                                value={item.openTask.CreatedDate}
                                                year="numeric"
                                                month="short"
                                                day="2-digit"
                                            ></lightning-formatted-date-time
                                        ></template>
                                    </div>
                                </div>
                            </lightning-layout-item>
                            <lightning-layout-item size="2" padding="around-small">
                                <!--Menu Items-->
                                <div
                                    class="slds-dropdown-trigger slds-dropdown-trigger_click"
                                    data-popup={item.openTask.Id}
                                    onclick={expandtheCard}
                                    tabindex="0"
                                >
                                    <div
                                        aria-haspopup="true"
                                        aria-expanded="true"
                                        title="Show More"
                                        onblur={closeMenu}
                                        tabindex="0"
                                    >
                                        <img src={threedots_imgUrl} class="image-result" />
                                    </div>
                                    <div
                                        class="slds-dropdown slds-dropdown_right"
                                        onblur={closeMenu}
                                        tabindex="0"
                                        style="
                                            margin-bottom: -98px;
                                            margin-top: -13px;
                                            margin-left: -65px;
                                        "
                                    >
                                        <ul
                                            class="slds-dropdown__list"
                                            role="menu"
                                            aria-label="Show More"
                                        >
                                            <template
                                                for:each={popupTaskMenuItems}
                                                for:item="citem"
                                            >
                                                <li
                                                    class="slds-dropdown__item popupdefault"
                                                    role="presentation"
                                                    key={citem}
                                                >
                                                    <a href="#" role="menuitem">
                                                        <span class="slds-truncate" >
                                                            <template
                                                                if:true={citem.reminder}
                                                            >
                                                                <c-web-icon
                                                                    class="svg-icon"
                                                                    icon-size="small"
                                                                    icon-name="reminderbell_icom"
                                                                    icon-color="#999999"
                                                                >
                                                                </c-web-icon
                                                            ></template>
                                                            <template
                                                                if:true={citem.edit}
                                                            >
                                                                <c-web-icon
                                                                    class="svg-icon"
                                                                    icon-size="small"
                                                                    icon-name="Pencil_Icon"
                                                                    icon-color="#999999"
                                                                >
                                                                </c-web-icon
                                                            ></template>
                                                            <template
                                                                if:true={citem.ignore}
                                                            >
                                                                <c-web-icon
                                                                    class="svg-icon"
                                                                    icon-size="small"
                                                                    icon-name="icon-close"
                                                                    icon-color="#999999"
                                                                >
                                                                </c-web-icon></template
                                                            >&nbsp;&nbsp;{citem.name}</span
                                                        >
                                                    </a>
                                                </li>
                                            </template>
                                        </ul>
                                    </div>
                                </div>
                                <!--End-->
                            </lightning-layout-item>
                        </div>
                    </template>
                </lightning-layout-item>
            </lightning-layout>
        </div>
    </div>
</template>
