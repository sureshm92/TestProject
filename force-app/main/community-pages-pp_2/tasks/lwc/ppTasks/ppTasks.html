<template>
    <!--Task Home page-->
    <template if:true={ishomepage}>
        <!-- Loading Spinner-->
        <c-web-spinner class="main-spinner" fixed="true"></c-web-spinner>
        <div class={cardRTL}>
            <!--Tasks Section-->
            <lightning-layout-item class="slds-p-vertical_small" size="12">
                <div class="tasks">{label.tasksHeader}</div>
            </lightning-layout-item>
            <lightning-layout class="slds-align_absolute-center" multiple-rows="true">
                <div class="box-border">
                    <div class="rectangle"></div>
                    <lightning-layout-item padding="around-small" size="12"
                        ><template if:true={isCreateTask}>
                            <c-pp-create-task ontaskclose={handleTaskClose}> </c-pp-create-task>
                        </template>
                        <template if:true={isShowModal}>
                            <section
                                role="dialog"
                                tabindex="-1"
                                aria-labelledby="modal-heading-01"
                                aria-modal="true"
                                aria-describedby="modal-content-id-1"
                                class="slds-modal slds-fade-in-open"
                            >
                                <div
                                    class="slds-modal__container complete-mask"
                                    data-modalpopup={popUpTaskId}
                                >
                                    <div class="complete-mask-margin">
                                        <lightning-layout>
                                            <lightning-layout-item
                                                ><div class="modal-title">
                                                    {label.taskMarkCompleteHeader}
                                                </div></lightning-layout-item
                                            >
                                            <lightning-layout-item
                                                style="margin-left: 5rem; margin-top: 2rem"
                                            >
                                                <lightning-icon
                                                    icon-name="utility:close"
                                                    size="small"
                                                    onclick={closeModel}
                                                >
                                                </lightning-icon></lightning-layout-item
                                        ></lightning-layout>

                                        <div class="modal-body">
                                            {label.taskMarkComplete}
                                            <!-- <a >Cancel</a>
                                            <button class="modalbutton">Confirm</button>-->
                                            <lightning-layout
                                                style="float: right; margin-right: -1rem"
                                            >
                                                <lightning-layout-item
                                                    style="margin-top: 2.5rem; margin-right: 1rem"
                                                >
                                                    <a onclick={closeModel}>{label.taskCancel}</a>
                                                </lightning-layout-item>
                                                <lightning-layout-item
                                                    style="margin-top: 2.2rem; margin-right: 1rem"
                                                >
                                                    <button
                                                        class="modal-button"
                                                        onclick={closeTheTask}
                                                    >
                                                        {label.taskConfirm}
                                                    </button>
                                                </lightning-layout-item>
                                            </lightning-layout>
                                        </div>
                                    </div>
                                </div>
                            </section>
                        </template>
                        <template for:each={openTasks} for:item="item" for:index="index">
                            <div
                                key={item}
                                class="home-inactive-custom-box slds-align_absolute-center"
                                data-parentdiv={item.openTask.Id}
                            >
                                <lightning-layout-item size="2">
                                    <template if:true={item.systemTask}>
                                        <div
                                            class="slds-p-around_medium"
                                            onclick={taskOpen}
                                            data-actionurl={item.openTask.Action_URL__c}
                                            data-index={item.openTask.Id}
                                        >
                                            <c-web-icon
                                                class="sys-task"
                                                icon-name="task-illustration"
                                                icon-size="big"
                                            >
                                            </c-web-icon>
                                        </div>
                                    </template>
                                    <template if:false={item.systemTask}>
                                        <div
                                            class="slds-p-around_medium empty-oval"
                                            onclick={showTaskCompleteModal}
                                            onmouseover={fillTheOpenIcon}
                                            onmouseout={fillTheOpenIcon}
                                            data-index={item.openTask.Id}
                                        >
                                            <template if:false={item.isClosed}>
                                                <c-web-icon
                                                    class="open-task-icon"
                                                    icon-name="icon-opentask"
                                                    icon-color=""
                                                >
                                                </c-web-icon>
                                            </template>
                                            <template if:true={item.isClosed}>
                                                <c-web-icon
                                                    class="open-task-icon"
                                                    icon-name="icon-completedtask"
                                                ></c-web-icon>
                                            </template>
                                        </div>
                                    </template>
                                </lightning-layout-item>
                                <lightning-layout-item
                                    size="8"
                                    class="mob-task-sub"
                                    padding="around-small"
                                >
                                    <lightning-layout>
                                        <lightning-layout-item size="12"
                                            ><span
                                                class={item.subjectClass}
                                                onclick={taskOpen}
                                                data-actionurl={item.openTask.Action_URL__c}
                                                data-index={item.openTask.Id}
                                                ><lightning-formatted-text
                                                    value={item.openTask.Subject}
                                                >
                                                </lightning-formatted-text
                                            ></span> </lightning-layout-item
                                    ></lightning-layout>
                                    <template if:true={item.criticalTask}
                                        ><span class="critical-rect"
                                            >{label.taskPriorityCritical}</span
                                        ></template
                                    >
                                    <lightning-layout
                                        ><lightning-layout-item size="12"
                                            ><template if:true={item.businessTask}
                                                ><span class="due-time"
                                                    >{label.taskDue} : &nbsp;
                                                    <template if:true={item.dueDate}>
                                                        <lightning-formatted-date-time
                                                            value={item.openTask.Activity_Datetime__c}
                                                            year="numeric"
                                                            month="short"
                                                            day="2-digit"
                                                            time-zone={userTimeZone}
                                                        ></lightning-formatted-date-time
                                                        >&nbsp;|&nbsp;
                                                        <lightning-formatted-date-time
                                                            value={item.openTask.Activity_Datetime__c}
                                                            hour="numeric"
                                                            minute="numeric"
                                                            time-zone={userTimeZone}
                                                        ></lightning-formatted-date-time
                                                    ></template>
                                                    <template if:false={item.dueDate}
                                                        >{label.notAvailable}</template
                                                    >
                                                </span></template
                                            >
                                            <template if:false={item.businessTask}
                                                ><span class="due-time"
                                                    >{label.taskReminder} :&nbsp;
                                                    <template
                                                        if:true={item.openTask.ReminderDateTime}
                                                    >
                                                        <lightning-formatted-date-time
                                                            value={item.openTask.ReminderDateTime}
                                                            year="numeric"
                                                            month="short"
                                                            day="2-digit"
                                                            time-zone={userTimeZone}
                                                        ></lightning-formatted-date-time>
                                                        &nbsp;|&nbsp;
                                                        <lightning-formatted-date-time
                                                            value={item.openTask.ReminderDateTime}
                                                            hour="numeric"
                                                            minute="numeric"
                                                            time-zone={userTimeZone}
                                                        ></lightning-formatted-date-time
                                                    ></template>
                                                    <template
                                                        if:false={item.openTask.ReminderDateTime}
                                                        >{label.notAvailable}</template
                                                    >
                                                </span></template
                                            ></lightning-layout-item
                                        >
                                    </lightning-layout>
                                </lightning-layout-item>
                                <!-- Critical Task UI -->
                                <lightning-layout-item size="2" padding="around-small">
                                    <!--Menu Items-->
                                    <c-web-icon
                                        icon-name="task_arrow"
                                        onclick={handleonclick}
                                    ></c-web-icon>
                                    <!--End-->
                                </lightning-layout-item>
                            </div>
                        </template>
                        <template if:true={emptyOpenTasks}>
                            <!-- Task List View UI with no data -->
                            <lightning-layout
                                class="home-inactive-custom-box slds-align_absolute-center home-no-task-list-view"
                            >
                                <div class="slds-align_absolute-center dis-block">
                                    <span class="center"><img src={systemTaskImg} /></span>
                                    <span class="no-task-txt slds-m-top_medium"
                                        >{label.noOpenTasks}</span
                                    >
                                </div>
                            </lightning-layout>
                        </template>
                    </lightning-layout-item>
                    <div class="slds-align_absolute-center">
                        <a class="comm-link" href={sfdcBaseURL} target="_blank">
                            <span>{label.viewAllTasks}</span>
                        </a>
                    </div>
                </div>
            </lightning-layout>
        </div>
    </template>
    <!--Task detail page-->
    <template if:false={ishomepage}>
        <!-- Loading Spinner-->
        <c-web-spinner class="main-spinner" fixed="true"></c-web-spinner>
        <div class={cardRTL}>
            <div>
                <lightning-layout multiple-rows="true">
                    <lightning-layout-item class="slds-p-vertical_small" size="12">
                        <div class="tasks">{label.tasksHeader}</div>
                    </lightning-layout-item>
                    <lightning-layout-item padding="around-small" size="12">
                        <div class="page-section page-header">
                            <div class="slds-align_absolute-center">
                                <button class={taskBtnOpenClass} onclick={navigateToOpen}>
                                    Open</button
                                ><button class={taskBtnCompleteClass} onclick={navigateToCompleted}>
                                    {label.taskPPCompleted}
                                </button>
                            </div>
                        </div>
                    </lightning-layout-item>

                    <template if:true={taskOpenTab}>
                        <lightning-layout-item padding="around-small" size="12">
                            <template if:true={showCreateTaskButton}>
                                <div class="slds-align_absolute-center">
                                    <button class={taskButtonClass} onclick={doCreateTask}>
                                        <span
                                            ><lightning-icon
                                                icon-name="utility:add"
                                                size="x-small"
                                                class="plus-icon"
                                            >
                                            </lightning-icon
                                        ></span>
                                        <span>{label.createNewTask}</span>
                                    </button>
                                </div>
                            </template>
                        </lightning-layout-item>
                        <lightning-layout class="slds-align_absolute-center" multiple-rows="true">
                            <lightning-layout-item class="overflow-scroll" size="12"
                                ><template if:true={isCreateTask}>
                                    <c-pp-create-task ontaskclose={handleTaskClose}>
                                    </c-pp-create-task>
                                </template>
                                <template if:false={emptyOpenTasks}>
                                    <c-pp-tasks-list
                                        container-class="inactive-custom-box slds-align_absolute-center"
                                        web-icon-class="open-task-icon slds-p-left_medium empty-oval"
                                        due-time-class="due-time"
                                        selected-tasks={openTasks}
                                        ontaskcreated={handleTaskCreated}
                                        system-icon-class="sys-task curpointer"
                                    ></c-pp-tasks-list>
                                </template>
                                <template if:true={emptyOpenTasks}>
                                    <lightning-layout
                                        class="inactive-custom-box slds-align_absolute-center no-task-list-view"
                                    >
                                        <div class="slds-align_absolute-center dis-block">
                                            <span class="center"><img src={systemTaskImg} /></span>
                                            <span class="no-task-txt slds-m-top_medium"
                                                >{label.noOpenTasks}</span
                                            >
                                        </div>
                                    </lightning-layout>
                                </template>
                            </lightning-layout-item>
                        </lightning-layout>
                    </template>
                    <template if:false={taskOpenTab}>
                        <lightning-layout class="slds-align_absolute-center" multiple-rows="true">
                            <lightning-layout-item class="overflow-scroll" size="12">
                                <template if:false={emptyCompletedTasks}>
                                    <c-pp-tasks-list
                                        container-class="inactive-custom-box slds-align_absolute-center complete-container"
                                        web-icon-class="open-task-icon slds-p-left_medium empty-oval cursor-default"
                                        due-time-class="due-time complete-datetime"
                                        selected-tasks={completedTasksList}
                                        expire-task-available="true"
                                        ontaskcreated={handleTaskCreated}
                                        system-icon-class="sys-task"
                                    ></c-pp-tasks-list>
                                    <template if:false={emptyIgnoreTasks}>
                                        <lightning-layout>
                                            <lightning-layout-item size="2"
                                                ><div class="ignored">
                                                    {label.taskPPIgnored}
                                                </div></lightning-layout-item
                                            >
                                            <lightning-layout-item size="8"
                                                ><div
                                                    class="path-2-copy"
                                                ></div></lightning-layout-item
                                        ></lightning-layout>
                                        <!-- Dispaying Task Card for Ignored Tasks ignoredTasksList-->
                                        <c-pp-tasks-list
                                            container-class="inactive-custom-box slds-align_absolute-center ignore-container"
                                            web-icon-class="open-task-icon slds-p-left_medium empty-oval"
                                            due-time-class="due-time ignore-datetime"
                                            selected-tasks={ignoredTasksList}
                                            ontaskcreated={handleTaskCreated}
                                            system-icon-class="sys-task curpointer"
                                        ></c-pp-tasks-list>
                                    </template>
                                    <template if:false={emptyExpiredTasks}>
                                        <lightning-layout>
                                            <lightning-layout-item size="2"
                                                ><div class="expired">
                                                    {label.taskPPExpired}
                                                </div></lightning-layout-item
                                            >
                                            <lightning-layout-item size="8"
                                                ><div
                                                    class="path-2-copy"
                                                ></div></lightning-layout-item
                                        ></lightning-layout>
                                        <c-pp-tasks-list
                                            container-class="inactive-custom-box slds-align_absolute-center expire-container"
                                            web-icon-class="open-task-icon slds-p-left_medium empty-oval cursor-default"
                                            due-time-class="due-time expire-datetime"
                                            selected-tasks={expiredTasksList}
                                            expire-task-available="true"
                                            system-icon-class="sys-task"
                                            ontaskcreated={handleTaskCreated}
                                        ></c-pp-tasks-list>
                                    </template>
                                </template>
                                <!--End Card for completed tasks-->

                                <!-- Task List View UI with no data -->
                                <template if:true={emptyCompletedTasks}>
                                    <lightning-layout
                                        class="inactive-custom-box slds-align_absolute-center no-task-list-view"
                                    >
                                        <div class="slds-align_absolute-center dis-block">
                                            <span class="center"><img src={systemTaskImg} /></span>
                                            <span class="no-task-txt slds-m-top_medium"
                                                >{label.noCompletedTasks}</span
                                            >
                                        </div>
                                    </lightning-layout>
                                </template>
                            </lightning-layout-item>
                        </lightning-layout>
                    </template>
                </lightning-layout>
            </div>
        </div>
    </template>
</template>
