<!--
 - Created by alekseymoseev on 12/10/19.
 -->

<aura:component description="Action_UploadParticipants" controller="Action_UploadParticipantsRemote">

    <ltng:require scripts="{!$Resource.jszip}"/>
    <ltng:require scripts="{!$Resource.xlsxmin}"/>

    <aura:attribute name="FileList" type="Object"/>
    <aura:attribute name="participantStatuses" type="List"/>
    <aura:attribute name="selectedStatus" type="String"/>
    <aura:attribute name="studySiteId" type="String"/>
    <aura:attribute name="reqFieldsFilled" type="Boolean"/>
    <aura:attribute name="fileName" type="String"/>
    <aura:attribute name="fileType" type="String"/>
    <aura:attribute name="fileBody" type="String"/>
    <aura:attribute name="fullFileName" type="String"/>
    <aura:attribute name="createUsers" type="Boolean" default="false"/>
    <aura:attribute name="doNotContactParticipants" type="Boolean" default="true"/>

    <!-- methods:-->
    <aura:method name="execute" action="{!c.doExecute}" access="public">
        <aura:attribute name="studySiteId" type="String"/>
        <aura:attribute name="callback" type="Function"/>
    </aura:method>


    <div class="mrc-invite-popup uploadParticipants">
        <c:Popup aura:id="uploadParticipantsDialog" title="{!$Label.c.SS_Upload_Participants}" size="medium">
            <c:RRSpinner aura:id="upModalSpinner" size="medium" showSpinner="false"/>
            <div class="slds-grid slds-grid_vertical">
                <div class="slds-grid slds-wrap">
                    <div class="slds-size_1-of-1 slds-p-horizontal_x-medium">
                        <div class="slds-m-around--small">
                            <div class="input-fields-labels">                             
                                <b>{!$Label.c.FU_Add_File}<abbr class="slds-required" title="required">* </abbr></b>
                               
                                <span style="float: right;">
                                    <ui:outputURL aura:id="oURL" value="{!$Resource.PARTICIPANTS_TEMPLATE}" label="{!$Label.c.FU_Download_Template}"/>
                                     <img class="upload-icon" src="{!$Resource.icon_download}" width="16" height="16"/>
                                </span>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="slds-grid slds-wrap slds-scrollable">
                    <div class="slds-size_2-of-2 slds-p-horizontal_x-medium">
                        <div class="slds-m-around--small uploadFiles" data-gtm="pnl_UploadNewParticipants_importFile">
                           
                            <lightning:input aura:id="file-input" type="file" files="{!v.FileList}" accept=".xls, .xlsx, .csv"
                                             name="file" multiple="false" onchange="{!c.upload}"/>
                             <div class="input-fields-labels">
                                {!v.fullFileName}
                                <aura:if isTrue="{!!empty(v.fullFileName)}">
                                    <a href="javascript:void(0)" onclick="{!c.doClearFile}">
                                         <img class="upload-close" src="{!$Resource.icon_delete}" width="14" height="14"/>
                                    </a>
                                </aura:if>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="slds-grid slds-wrap">
                    <div class="slds-size_2-of-2 slds-p-horizontal_x-medium">
                        <div class="slds-m-around--small">
                            <div class="input-fields-labels"><b>{!$Label.c.PG_AP_F_Patient_Status_Select}</b></div>
                        </div>
                    </div>
                </div>
                <div class="slds-grid slds-wrap">
                    <div class="slds-size_1-of-1 slds-p-horizontal_x-medium">
                        <div class="slds-m-around--small" data-gtm="pnl_UploadNewParticipants_status">
                            <div class="input-fields-labels">
                                {!$Label.c.PG_AP_F_Patient_Status}<abbr class="slds-required" title="required">*</abbr></div>
                            <c:rrSelect id="statusesPicklist"
                                        options="{!v.participantStatuses}"
                                        value="{!v.selectedStatus}"
                                        class="delegate-select"
                                        placeholder="{!$Label.c.PG_AC_Select}"
                                        useSentenceFont="false"/>
                        </div>
                    </div>
                </div>
            </div>
            <div data-gtm="checkbox_Permit_IQVIA_Connect" class="slds-max-small-size--1-of-1 slds-grid slds-grid--vertical-align-center" style="margin-bottom: 15px; margin-top: 15px">
                <lightning:input type="checkbox" class="invite-patient-checkbox" checked="{!v.doNotContactParticipants}"/>
                <div class="slds-size_1-of-1 slds-item_label">{!$Label.c.PG_Ref_L_Permit_IQVIA_To_Contact}</div>
            </div>
            <div class="slds-max-small-size--1-of-1 slds-grid slds-grid--vertical-align-center">
                <lightning:input type="checkbox" class="invite-patient-checkbox" checked="{!v.createUsers}"/>
                <div class="slds-size_1-of-1 slds-item_label">{!$Label.c.Create_Users_Checkbox_on_Import}</div>
            </div>

            <div class="slds-col slds-size--1-of-1 slds-max-small-size--1-of-1 slds-grid slds-grid--vertical-align-center slds-textInfo-label" style="margin-top: 15px;">
                {!$Label.c.Create_Users_Allow_Several_Minutes}
            </div>

            <aura:set attribute="footerButtons">
                <div class="slds-grid slds-wrap">
                    <div class="slds-col slds-size--5-of-12" style="margin-left: 60%;">
                        <button class="apollo-btn tertiary slds-button__icon_right" data-gtm="btn_UploadNewParticipants_cancel"
                                onclick="{!c.doCancel}">
                            {!$Label.c.BTN_Cancel}
                        </button>
                        <button class="apollo-btn primary slds-button__icon_right" onclick="{!c.doImport}"
                                data-gtm="btn_UploadNewParticipants_import"
                                disabled="{!!v.selectedStatus || !v.fileName}"
                                title="{!(!v.selectedStatus || !v.fileName) ? $Label.c.PG_MRC_RF_Not_all_Req_Fields : ''}">
                            {!$Label.c.BTN_Import}
                        </button>
                    </div>
                </div>
            </aura:set>

        </c:Popup>
    </div>

</aura:component>