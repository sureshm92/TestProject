<!--
 - Created by Igor Malyuta on 12.04.2019.
 -->

<aura:component description="StudyVisits" controller="ParticipantVisitsRemote">

    <ltng:require scripts="{!join(',', $Resource.rr_community_js)}" afterScriptsLoaded="{!c.doInit}"/>

    <!--attributes-->
    <aura:attribute name="visitWrappers" type="PatientVisitService.VisitWrapper[]"/>
    <aura:attribute name="currentVisits" type="PatientVisitService.VisitWrapper[]"/>
    <aura:attribute name="initialized" type="Boolean" default="false"/>
    <aura:attribute name="visitModeCurrent" type="String" access="private" default="Current"/>
    <aura:attribute name="visitMode" type="String" default="{!v.visitModeCurrent}"/>
    <aura:attribute name="iconNames" type="String" default=""/>

    <!--HANDLERS-->
    <aura:handler name="change" value="{!v.visitMode}" action="{!c.doInit}"/>

    <c:RRSpinner aura:id="spinner" size="medium" showSpinner="true" fixed="true"/>

    <div class="{!'sv-body ' + if(v.initialized, '', 'hidden')}">
        <div class="tt-title">
            {!$Label.c.Home_Page_StudyVisit_Title}
            <div class="apollo-btn">
                <c:TravelSupport/>
            </div>
        </div>

        <ui:scrollerWrapper>
            <aura:if isTrue="{!!empty(v.visitWrappers)}">
                <c:RRTable>
                    <tr>
                        <th class="sv-t-name">{!$Label.c.Home_Page_StudyVisit_Visit}</th>
                        <th class="sv-t-time">{!$Label.c.Home_Page_StudyVisit_Schedule}</th>
                        <th class="sv-t-icons">{!v.visitMode == v.visitModeCurrent ? $Label.c.Home_Page_StudyVisit_WhToEx : $Label.c.Home_Page_StudyVisit_What_Took_Place}</th>
                        <th class="{!v.visitMode == v.visitModeCurrent ? 'sv-t-status' : 'invisible'}">{!$Label.c.Home_Page_StudyVisit_Status}</th>
                        <th class="{!v.visitMode == v.visitModeCurrent ? '' : 'invisible'}">{!$Label.c.Home_Page_StudyVisit_Reminder}</th>
                        <th class="{!v.visitMode == v.visitModeCurrent ? 'invisible' : 'sv-t-completed-date'}">{!$Label.c.Home_Page_StudyVisit_Completed_On}</th>
                    </tr>
                    <aura:iteration var="visitWrapper" items="{!v.currentVisits}">
                        <tr>
                            <td class="sv-t-name">{!(visitWrapper.visit.Is_Adhoc__c
                                ? $Label.c.StudyVisit_Unscheduled_Visit
                                : visitWrapper.visit.Visit__r.Patient_Portal_Name__c)}</td>
                            <td class="sv-t-time">{!(visitWrapper.visit.Is_Adhoc__c ? $Label.c.StudyVisit_Ad_hoc_Visit : visitWrapper.visit.Visit__r.Visit_Schedule__c)}</td>
                            <td class="{!visitWrapper.visit.Is_Adhoc__c ? 'invisible' : 'sv-t-icons'}">
                                <c:RRIconSplitter numOfIconsToDisplay="50" class="svl-icon"
                                                  value="{!visitWrapper.icons}"/>
                            </td>
                            <td class="{!visitWrapper.visit.Is_Adhoc__c ? 'sv-t-icons' : 'invisible'}">{!$Label.c.StudyVisit_Variable}</td>
                            <td class="{!v.visitMode == v.visitModeCurrent ? 'sv-t-status' : 'invisible'}">{!visitWrapper.visit.Status__c}</td>
                            <td class="{!v.visitMode == v.visitModeCurrent ? 'sv-t-reminder' : 'invisible'}"
                                data-visit-id="{!visitWrapper.visit.Id}"
                                data-task-id="{!visitWrapper.task.Id}"
                                onclick="{!c.createEditTask}">
                                {!visitWrapper.task == null ? $Label.c.Create : visitWrapper.reminderDate}
                            </td>
                            <td class="{!v.visitMode == v.visitModeCurrent ? 'invisible' : 'sv-t-completed-date'}">{!visitWrapper.completedDate}</td>
                        </tr>
                    </aura:iteration>
                </c:RRTable>
                <div class="pagination">
                    <c:rrPagination allObjects="{!v.visitWrappers}" currentObjects="{!v.currentVisits}"
                                    entriesOnPage="4"/>
                </div>
            </aura:if>
            <c:EmptyListStub class="no-visits-message" targetList="{!v.visitWrappers}" iconName="none"/>
        </ui:scrollerWrapper>

        <aura:if isTrue="{!v.initialized}">
            <c:StudyVisitsLegend iconNames="{!v.iconNames}"/>
        </aura:if>
    </div>
</aura:component>