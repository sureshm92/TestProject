<!--
 - Created by Igor Malyuta on 24.09.2019.
 -->

<aura:component description="Action_EditVisitPlan" controller="VisitPlanRemote">

    <!--attributes-->
    <aura:attribute name="plan" type="Object"/>
    <aura:attribute name="visits" type="List"/>
    <aura:attribute name="icons" type="List"/>

    <aura:attribute name="callback" type="Object" access="private"/>
    <aura:attribute name="mode" type="String" access="private"/>

    <aura:handler name="init" value="{!this}" action="{!c.doInit}"/>

    <!--methods: -->
    <aura:method name="execute" action="{!c.doExecute}">
        <aura:attribute name="vpId" type="String"/>
        <aura:attribute name="callback" type="Function"/>
        <aura:attribute name="mode" type="String"/>
    </aura:method>

    <!--Create/Edit Visit Plan-->
    <c:uiModal aura:id="createVisitPlan" size="medium" headerText="Add Visit Plan">
        <div style="position: relative">
            <c:RRSpinner aura:id="spinner"/>
            <div class="slds-grid slds-gutters slds-grid_vertical-align-end slds-p-bottom--small">
                <div class="slds-col slds-size--2-of-5">
                    <lightning:input type="text" label="Visit Plan Name" value="{!v.plan.Name}"/>
                </div>
                <div class="slds-col slds-size--1-of-5"></div>
                <div class="slds-col slds-size--1-of-5">
                    <lightning:button variant="neutral" type="button" label="{!$Label.c.Edit_Visit_Legend}"
                                      onclick="{!c.doEditLegend}"/>
                </div>
                <div class="slds-col slds-size--1-of-5">
                    <lightning:button variant="neutral" type="button" label="{!$Label.c.Visit_b_Add_Visit}"
                                      onclick="{!c.doAddVisit}"/>
                </div>
            </div>
            <!--Visits table-->
            <aura:if isTrue="{!not(empty(v.visits))}">
                <div class="slds-scrollable visits-table">
                    <table class="slds-table slds-table_bordered">
                        <thead>
                        <tr class="slds-text-title_caps">
                            <th scope="col">
                                <div class="slds-truncate">{!$Label.c.visit_Name}</div>
                            </th>
                            <th scope="col">
                                <div class="slds-truncate">{!$Label.c.Visit_Patient_Portal_Name}</div>
                            </th>
                            <th scope="col">
                                <div class="slds-truncate">{!$Label.c.Visit_Number}</div>
                            </th>
                            <th scope="col">
                                <div class="slds-truncate">{!$Label.c.Visit_Schedule}</div>
                            </th>
                            <th scope="col">
                                <div class="slds-truncate">{!$Label.c.Visit_Icons}</div>
                            </th>
                        </tr>
                        </thead>
                        <tbody>
                        <aura:iteration var="visit" items="{!v.visits}">
                            <aura:if isTrue="{!not(visit.deleted)}">
                                <c:VisitItem visit="{!visit}" parent="{!this}"
                                             selectedRowColor="rgb(243, 242, 242)"
                                             onEdit="{!c.doVisitItemEdit}"
                                             onDelete="{!c.doVisitItemDelete}"/>
                            </aura:if>
                        </aura:iteration>
                        </tbody>
                    </table>
                </div>
            </aura:if>
        </div>
        <aura:set attribute="footer">
            <lightning:button variant="neutral" type="button" name="createVisitPlan"
                              label="{!$Label.c.Visit_b_Close}"
                              onclick="{!c.cancelClick}"/>
            <lightning:button variant="brand" type="button" name="save" label="{!$Label.c.Visit_b_Save}"
                              disabled="{!empty(v.plan.Name)}" onclick="{!c.saveVP}"/>
        </aura:set>
    </c:uiModal>

    <!--Actions: -->
    <c:Action_EditIconLegend aura:id="actionLegend" planId="{!v.plan.Id}"/>
    <c:Action_EditVisit aura:id="actionVisit" icons="{!v.icons}"/>

    <c:IconsStaticResourceService aura:id="iconsService"
                                  staticResourceName="Icons_legend"
                                  IconsPackageFIlePath="/icons.svg"/>
</aura:component>
