<!--
 - Created by Igor Malyuta on 01.03.2019.
 -->

<aura:component description="Manual_Task" controller="ManualTaskRemote"
                implements="forceCommunity:availableForAllPageTypes,force:appHostable">

    <ltng:require scripts="{!join(',', $Resource.rr_community_js)}" afterScriptsLoaded="{!c.doInit}"/>

    <!--attributes: -->
    <aura:attribute name="task" type="Task"/>
    <aura:attribute name="priorities" type="String[]"/>
    <aura:attribute name="showNumbersAdd" type="Boolean" default="false"/>
    <aura:attribute name="dayDue" type="Integer" default="0"/>
    <aura:attribute name="patientStatuses" type="List"
                    default="[
                        {'label': 'Prospect', 'value' : 'Prospect'},
                        {'label': 'Referred', 'value' : 'Referred'},
                        {'label': 'Enrolled', 'value' : 'Enrolled'},
                        {'label': 'Alumni',   'value' : 'Alumni'}
                        ]"/>
    <aura:attribute name="statuses" type="List"/>
    <aura:attribute name="taskFilters" type="ManualTaskFilter"/>

    <!-- component body -->
    <lightning:card title="Configure your tasks parameters below">
        <c:RRSpinner aura:id="spinner" size="medium" />
        <div class="slds-grid slds-gutters mt-panel">
            <div class="slds-col slds-size--1-of-4">
                <div class="section-title">Task details</div>
                <lightning:input label="Enter Subject" value="{!v.task.Subject}" required="true"/>
                <lightning:select label="Set Priority for the Task:" value="{!v.task.Priority}" required="true">
                    <aura:iteration items="{!v.priorities}" var="prior">
                        <option label="{!prior}" value="{!prior}"/>
                    </aura:iteration>
                </lightning:select>

                <lightning:input type="date" label="Set Task Start Date" value="{!v.task.Start_Date__c}" required="true"/>
                <aura:if isTrue="{!v.showNumbersAdd}">
                    <lightning:input aura:id="due" type="date" label="Set Task Due Date" value="{!v.task.ActivityDate}"
                                     readonly="true"/>
                    <aura:set attribute="else">
                        <lightning:input aura:id="due" type="date" label="Set Task Due Date" value="{!v.task.ActivityDate}"
                                         required="true" onchange="{!c.dueDateValid}"/>
                    </aura:set>
                </aura:if>

                <lightning:select label="Select format" value="{!v.showNumbersAdd}">
                    <option value="false">Specific Date</option>
                    <option value="true">Number of days from the Task start date</option>
                </lightning:select>
                <aura:if isTrue="{!v.showNumbersAdd}">
                    <lightning:input type="number" value="{!v.dayDue}" placeholder="Adjust days"
                                     onchange="{!c.dueDateAdd}" min="0"/>
                </aura:if>
            </div>
            <div class="slds-col slds-size--3-of-4">
                <div class="section-title">Filters for Task recipients</div>
                <div class="slds-grid slds-gutters">
                    <div class="slds-col slds-size--1-of-2">
                        <lightning:checkboxGroup
                                name="patientStatus" label="Set Patient Status"
                                options="{!v.patientStatuses}"
                                value="{!v.statuses}" required="true"/>

                        <c:ManualTaskLookup label="Therapeutic Area" selection="{!v.taskFilters.areas}"
                                            objType="therapeutic"/>
                        <c:ManualTaskLookup label="Select Sponsor" selection="{!v.taskFilters.sponsors}" objType="sponsor"/>
                    </div>
                    <div class="slds-col slds-size--1-of-2">
                        <c:ManualTaskLookup label="Study" selection="{!v.taskFilters.studies}" objType="study"/>
                        <c:ManualTaskLookup label="Select country" selection="{!v.taskFilters.countries}"
                                            objType="countries"/>
                        <c:ManualTaskLookup label="Select Site" selection="{!v.taskFilters.sites}" objType="site"/>
                    </div>
                </div>
            </div>
        </div>
        <div class="slds-text-align_right slds-p-right_small">
            <lightning:button variant="brand" label="Create Tasks" onclick="{!c.createTask}"/>
            <lightning:button label="Reset" onclick="{!c.resetClick}"/>
        </div>
    </lightning:card>
</aura:component>
