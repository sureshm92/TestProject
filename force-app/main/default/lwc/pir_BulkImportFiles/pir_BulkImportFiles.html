<template>
    <div class="bulkImport">
        <div class="slds-grid slds-wrap slds-gutters"> 
            <div class="slds-col slds-size_1-of-1 slds-medium-size_6-of-12 slds-large-size_6-of-12">
                <div class="bulkImportFile d_none">
                    Bulk Import Files
                </div>
            </div>     
            <div class="slds-col slds-size_1-of-1 slds-medium-size_6-of-12 slds-large-size_6-of-12">
                <div class="slds-grid slds-wrap slds-gutters"> 
                    <div class="slds-col slds-size_1-of-2 btn-width_Instruction" >
                        <button class="slds-button slds-button_neutral btn_height" onclick={openIntructModal}>
                            <img src={instructionsSvgURL}/><span class="slds-p-left_small">Instructions</span>
                        </button>                   
                    </div>   
                    <div class="slds-col slds-size_1-of-2 btn-width_Template" 
                   >
                        <button class="slds-button slds-button_neutral btn_height"  >
                            <a href={downloadTemplate} title="">
                            <img src={downloadSvgURL}/ ><span class="slds-p-left_small">File Template</span></a>
                        </button> 
                    </div> 
                    <div class="slds-col slds-size_1-of-1 btn-width_Participants">
                        <button class="slds-button slds-button_neutral bulk-importButton btn_height" onclick={handleImportModal}>
                            <img src={impotrtSvgURL}/><span class="slds-p-left_small">Import Participants</span>
                        </button>  
                    </div>  
                </div>    
            </div> 
            <div class="slds-col slds-size_1-of-1 slds-medium-size_6-of-12 slds-large-size_6-of-12 slds-m-bottom_small">
                <div class="bulkImportFile d_noneD">
                    Bulk Import Files
                </div>
            </div>   
        </div><!-- slds-grid slds-wrap slds-gutters -->
           
        <div class="slds-grid slds-wrap slds-gutters"> 
            <template if:true={saving}>
                <lightning-spinner alternative-text="Loading..." variant="brand">
                </lightning-spinner>
            </template>
           <!-- <template if:false={bulkImportList}>
                <div class="overflowSet" style="position:relative">
                    <div role="status" class="slds-spinner slds-spinner_medium">
                        <span class="slds-assistive-text">Loading</span>
                        <div class="slds-spinner__dot-a"></div>
                        <div class="slds-spinner__dot-b"></div>
                    </div>
                    </div>
            </template>-->
            <div class="slds-col slds-size_1-of-1 slds-medium-size_12-of-12 slds-large-size_12-of-12 slds-m-top_medium">
                <div class="table-width nodata">
                    <table role="grid" class="slds-table slds-table_cell-buffer slds-table_bordered table-border table-width-D">
                        <colgroup>
                            <col class="fName">
                            <col class="fRecord">
                            <col span=2 class="fAccepted">
                            <col class="fRejected">
                            <col class="fUploadedBy">
                            <col class="fUploadedOn">
                            <col class="fStatus">
                        </colgroup>
                        <!--Header of the table-->
                        <thead>
                            <tr class="slds-line-height_reset">
                                <th class="table-header" scope="col">
                                    <div class="table-header-label slds-truncate" title="File Name">File Name</div>
                                </th>
                                <th class="table-header slds-text-align_center" scope="col">
                                    <div class="table-header-label slds-truncate" title="Initial Total Records">Initial Total Records</div>
                                </th>
                                <th class="table-header slds-text-align_center" scope="col">
                                    <div class="table-header-label slds-truncate" title="Accepted">Accepted</div>
                                </th>
                                <th class="table-header slds-text-align_center" scope="col">
                                    <div class="table-header-label slds-truncate" title="Rejected">Rejected</div>
                                </th>
                                <th class="table-header" scope="col">
                                    <div class="table-header-label slds-truncate" title="Uploaded By">Uploaded By</div>
                                </th>
                                <th class="table-header" scope="col">
                                    <div class="table-header-label slds-truncate" title="Uploaded On">Uploaded On</div>
                                </th>
                                <th class="table-header slds-text-align_center" scope="col">
                                    <div class="table-header-label slds-truncate" title="Actions">Actions</div>
                                </th>
                              <!---  <th class="table-header slds-text-align_center" scope="col">
                                    <div class="table-header-label slds-truncate" title="Status">Status</div>
                                </th>-->
                            </tr>
                        </thead>
                        <template if:true={bulkImportList}>
                           
                        <template for:each={bulkImportList} for:item="b"  for:index="index">
                            <tbody key={b.Id}>
                                <tr class="slds-hint-parent table-row">                      
                                    <td data-label="fname">
                                        <div class="slds-truncate" title={b.File_Name__c}>{b.File_Name__c}</div>
                                    </td>
                                    <td data-label="frecord" class="slds-text-align_center">
                                        <div class="slds-truncate" title={b.Initial_Total_Records__c}>{b.Initial_Total_Records__c}</div>
                                    </td>
                                    <td data-label="faccepted" class="slds-text-align_center">
                                        <div class="slds-truncate" title={b.Accepted_Records__c}>{b.Accepted_Records__c}</div>
                                    </td>    
                                    <td data-label="frejected" class="slds-text-align_center">
                                        <div class="slds-truncate slds-text-color_error color_error_bold" title={b.Rejected_Records__c}>{b.Rejected_Records__c}</div>
                                    </td>   
                                    <td data-label="fuploadedBy">
                                        <div class="slds-truncate" title={b.Uploaded_By__r.Full_Name__c}>{b.Uploaded_By__r.Full_Name__c}</div>
                                    </td>   
                                    <td data-label="fuploadedOn">
                                        <div class="slds-truncate" title={b.CreatedDate}> 
                                            <lightning-formatted-date-time year="numeric" month="short" day="2-digit" value={b.CreatedDate}></lightning-formatted-date-time>
                                        </div>
                                    </td>  
                                      
                                    <td data-label="action" class="slds-text-align_center">
                                        <template if:true={b.Download_URL__c}> 
                                        <div class="slds-truncate" title=""> 
                                            <a href={b.Download_URL__c} target="_blank">
                                                <lightning-icon icon-name="utility:download" size="small" alternative-text="Download" title="Download"> </lightning-icon>
                                            </a>
                                        </div>
                                    </template>
                                    </td> 
                               <!--     <td data-label="fStatus" class="slds-text-align_center">
                                        <div class="slds-truncate" title="test ">test status</div>
                                    </td>        -->         
                                </tr>  
                                
                                                           
                            </tbody>
                        </template>
                    </template>
                       
                    </table>
                </div> 
             </div> <!-- table without data slds-col slds-size_1-of-1 -->   
             <template if:true={isInstrModalOpen}>
                     <!--  Import Participants Model Start  -->  
                        <section role="dialog" tabindex="-1" aria-labelledby="modal-heading-01" aria-modal="true"
                        aria-describedby="modal-content-id-1" class="slds-modal slds-modal_small slds-align--absolute-center slds-fade-in-open">
                        <div class="slds-modal_small">
                        <div class="slds-modal__container model-small">
                            <div class="slds-modal__content" id="modal-content-id-1">
                                <div class="bar"></div>
                                <div class="slds-p-around_large"><!-- Add RTL class here -->
                                    <div class="slds-grid slds-gutters close-arrow-left slds-m-bottom_small">
                                    <div class="slds-col slds-large-size_11-of-12 slds-medium-size_11-of-12 slds-size_10-of-12">
                                        <span class="pop-title">Instructions for Bulk Import Process</span> 
                                    </div>
                                    <div class="slds-col slds-size_1-of-12 close-icon">
                                        <div onclick={handleClose}>
                                            <lightning-icon icon-name="utility:close"
                                                alternative-text="close"
                                                size="x-small" ></lightning-icon>
                                            <span class="slds-assistive-text">Close</span>
                                        </div>
                                    </div>
                                    </div>
                                    <slot name="body">
                                    <div class="slds-grid slds-wrap slds-gutters bulkImportScroll">
                                        <div class="slds-col slds-size_1-of-1 slds-medium-size_12-of-12 slds-large-size_12-of-12 slds-m-bottom_small">
                                            <div class="importInfo">
                                                <div class="processTextBody">
                                                    <ol type="1" class="">
                                                        <li class="listText"> 
                                                            Click the <strong>File Template</strong> download button near the top right of the table to access file with the acceptable import format.
                                                        </li>     
                                                        <li class="listText">                         
                                                            Enter available information for the participants into the file.
                                                        </li>    
                                                        <li class="listText">                         
                                                            Click on <strong> Import Participants </strong> 
                                                        </li> 
                                                        <li class="listText">                         
                                                            Select the <strong>  Study Name and Study Site </strong>
                                                        </li> 
                                                        <li class="listText">                         
                                                            Drag-and-drop or browse to locate and <strong> upload </strong> the file.
                                                        </li> 
                                                        <li class="listText">                         
                                                            Attest to information sharing and contact consent for the participants and/or their legal guardians included in the file.
                                                        </li> 
                                                        <li class="listText">                         
                                                            Choose to Invite to Patient Portal if applicable.
                                                        </li> 
                                                        <li class="listText">                         
                                                            Click <strong>Import.</strong> 
                                                        </li> 
                                                        <li class="listText">                         
                                                            The results of your upload will appear at the top of the table with the total records, accepted records, and rejected records displayed.                                        </li> 
                                                        <li class="listText">                         
                                                            All accepted records can now be found in your  <strong> My Participants  </strong> list.
                                                        </li>                              
                                                        <li class="listText"> 
                                                            Any rejected records will require correction and re-upload
                                                            <ol>
                                                                <li class="listText">                         
                                                                    Click the download icon under the Actions column of the applicable row in the Bulk Import Files list 
                                                                </li>  
                                                                <li class="listText">                         
                                                                    Check the <strong> Validation Errors </strong>  column in the file for the rejection reason
                                                                </li> 
                                                                <li class="listText">                         
                                                                    Input applicable changes directly into the file to correct the indicated errors and save the file (do NOT change the file name)
                                                                </li> 
                                                                <li class="listText">                         
                                                                    Repeat steps 3-8 above.
                                                                </li>    
                                                            </ol>
                                                        </li>
                                                    </ol>
                                                </div>
                                            </div>
                                        </div>
                                    </div><!-- slds-grid slds-wrap slds-gutters -->
                                    <div class="slds-grid slds-wrap slds-m-top_small">
                                        <div class="slds-col slds-size_1-of-1 slds-medium-size_12-of-12 slds-large-size_12-of-12 slds-m-bottom_x-small custom-position">
                                            <lightning-input type="checkbox" label="Don't show me again on landing" onchange={instructionUpdate}
                                            name="input3" checked={dontshowInstruction}
                                            ></lightning-input>
                                        </div>
                                        <div class="slds-col slds-size_1-of-1 slds-medium-size_12-of-12 slds-large-size_12-of-12">
                                            <div class="slds-float_right mobile-width">                  
                                                <button title="" class="slds-button apollo-btn primary btn-height import-btn" onclick={updateShowInstructValue}> Ok  </button>
                                            </div>
                                        </div>
                                    </div><!-- slds-grid slds-wrap slds-gutters -->
                                    
                                    </slot><!-- slot -->
                                </div>
                            </div>
                        </div>
                        </div>
                    </section>
                    <div class="slds-backdrop slds-backdrop_open"></div>
                    <!--  Import Participants Model End --> 
             </template>
             <template if:true={noRecords}> 
                <div class="slds-col slds-size_1-of-1 slds-medium-size_12-of-12 slds-large-size_12-of-12">
                   <div class="noData slds-align--absolute-center">
                       <div class="slds-grid slds-wrap slds-gutters"> 
                           <div class="slds-col slds-size_1-of-1 slds-medium-size_12-of-12 slds-large-size_12-of-12 bulkImportFile slds-text-align_center">
                               Imported files with participants will be shown here.<br>
                               Click on Import Participants to upload a file.
                           </div>
                                             
                       </div> <!-- slds-grid slds-wrap slds-gutters -->     
                   </div><!-- noData -->    
                </div>
               </template>             
        </div><!-- slds-grid slds-wrap slds-gutters table with data  -->  
       
       <!---<div class="pg slds-align--absolute-center slds-border--bottom slds-border--left slds-border--right slds-grid slds-wrap pagination-widthD">      
            <template if:true={totalRecord}>
                <c-pir_participant-pagination total-records={totalRecord} onpagechange={pageChanged}></c-pir_participant-pagination>
             </template>
        </div>--> <!-- slds-grid slds-wra Pg pagination End -->      
    
    </div><!-- bulkImport -->
    <template if:true={importParticipant}> 
        <c-pir_import-participant onclose={handleImportParticipant} > </c-pir_import-participant>
     </template>
</template>