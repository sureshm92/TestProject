<!--
 - Created by Igor Malyuta on 30.05.2019.
 -->

<aura:component description="AdminPanel" controller="AdminPanelRemote"
                implements="forceCommunity:availableForAllPageTypes,force:appHostable">

    <ltng:require scripts="{!join(',', $Resource.rr_community_js)}" afterScriptsLoaded="{!c.doInit}"/>

    <aura:attribute name="jobs" type="List"/>

    <aura:method name="refresh" action="{!c.doInit}"/>

    <lightning:card title="Batches">
        <c:RRSpinner aura:id="spinner" size="medium"/>
        <div class="ad-panel">
            <table class="slds-table slds-table_cell-buffer slds-no-row-hover slds-table_bordered">
                <thead>
                <tr class="slds-line-height_reset">
                    <th class="" scope="col">
                        <div class="slds-truncate" title="Job Name">Job Name</div>
                    </th>
                    <th class="" scope="col">
                        <div class="slds-truncate" title="State">State</div>
                    </th>
                    <th class="" scope="col">
                        <div class="slds-truncate" title="Previous launch">Previous launch</div>
                    </th>
                    <th class="" scope="col">
                        <div class="slds-truncate" title="Next launch">Next launch</div>
                    </th>
                    <th class="" scope="col">
                        <div class="slds-truncate" title="Period (min)">Period (min)</div>
                    </th>
                    <th class="" scope="col">
                        <div class="slds-truncate" title="Action">Action</div>
                    </th>
                </tr>
                </thead>
                <tbody>
                <aura:iteration items="{!v.jobs}" var="job">
                    <tr class="slds-hint-parent ad-table">
                        <th data-label="Job Name" scope="row">
                            <p class="slds-text-heading--label-medium slds-text-title_bold">{!job.label}</p>
                        </th>
                        <td><span class="{!job.css}">{!job.state}</span></td>
                        <td>
                            <a href="/lightning/setup/AsyncApexJobs/home">
                                <ui:outputDateTime value="{!job.prevLaunch}"/>
                            </a>
                            <aura:if isTrue="{!!empty(job.prevJob.ExtendedStatus)}">
                                <lightning:helptext
                                        class="slds-p-left--xx-small"
                                        content="{!job.prevJob.ExtendedStatus}"
                                        iconName="utility:warning"
                                        iconVariant="error"/>
                            </aura:if>
                        </td>
                        <td>
                            <ui:outputDateTime value="{!job.nextLaunch}"/>
                        </td>
                        <td>{!job.period}</td>
                        <td>
                            <aura:if isTrue="{!job.state == 'STOPPED'}">
                                <span data-record="{!job.jobName}" onclick="{!c.clickRun}">
                                    <lightning:buttonIcon iconClass="slds-icon-text-success"
                                                          iconName="utility:play"
                                                          size="small"
                                                          variant="border-filled" alternativeText="Run Batch"/>
                                </span>
                                <aura:set attribute="else">
                                <span data-record="{!job.jobName}" onclick="{!c.clickStop}">
                                    <lightning:buttonIcon iconClass="slds-icon-text-error"
                                                          iconName="utility:stop"
                                                          size="small"
                                                          variant="border-filled" alternativeText="Stop Batch"/>
                                </span>
                                </aura:set>
                            </aura:if>
                        </td>
                    </tr>
                </aura:iteration>
                </tbody>
            </table>
            <div class="ad-card">
                    <span class="slds-text-heading--label-medium slds-text-title_bold">
                        Refresh Slide Tour</span>
                <button class="slds-button slds-button_outline-brand"
                        data-record="all" onclick="{!c.clickRunMode}">Run for all
                </button>
                <button class="slds-button slds-button_outline-brand"
                        data-record="pi" onclick="{!c.clickRunMode}">Run for PI's
                </button>
                <button class="slds-button slds-button_outline-brand"
                        data-record="hcp" onclick="{!c.clickRunMode}">Run for HCP's
                </button>
                <button class="slds-button slds-button_outline-brand"
                        data-record="part" onclick="{!c.clickRunMode}">Run for Participant's
                </button>
            </div>
        </div>
    </lightning:card>
</aura:component>
