<!--
 - Created by Leonid Bartenev
 -->

<aura:component description="AddPatientByPI" implements="forceCommunity:availableForAllPageTypes"
                controller="AddPatientByPIRemote">
    <ltng:require scripts="{!join(',', $Resource.rr_community_js)}" afterScriptsLoaded="{!c.doInit}"/>

    <!-- private attributes: -->
    <aura:attribute name="pe" type="Participant_Enrollment__c"/>
    <aura:attribute name="participant" type="Participant__c"/>
    <aura:attribute name="formData" type="AddPatientByPIRemote.FormData"/>
    <aura:attribute name="ctp" type="Clinical_Trial_Profile__c"/>
    <aura:attribute name="ss" type="Study_Site__c"/>
    <aura:attribute name="isValid" type="Boolean"/>
    <aura:attribute name="initialized" type="Boolean" default="false"/>

    <!-- handlers: -->
    <aura:handler event="c:EventCommunityInitialized" action="{!c.doInit}"/>

    <!-- component body: -->
    <c:RRSpinner aura:id="spinner" fixed="true" size="medium" showSpinner="true"/>
    <c:RRTopBar backLabel="{!$Label.c.PG_TOP_Bar_Back_To_My_Referrals}"
                backPage=""
                smallTitle="{!v.ctp.Study_Code_Name__c}"
                bigTitle="{!$Label.c.PG_Add_Patient_Header}">
    </c:RRTopBar>
    <c:RRActionApprove aura:id="actionApprove" message="{!$Label.c.Poput_ICF}" approveBtnName="{!$Label.c.BTN_Confirm}"/>

    <aura:if isTrue="{!v.initialized}">
        <div class="rr-width-limiter side-padding">
            <div class="ap-top-info">{! '* ' +  $Label.c.PG_AP_T_Indicate_Req_Fields}</div>
            <div class="rr-white-panel padding">
                <c:Form_EditPatientInfo aura:id="editForm"
                                        participant="{!v.participant}"
                                        pe="{!v.pe}"
                                        formData="{!v.formData}"
                                        isValid="{!v.isValid}"
                                        visitPlanRequired="{!v.ctp.Patient_Portal_Enabled__c}"/>
            </div>
            <div class="ap-bottom-info">
                {!$Label.c.PG_AP_T_Additional_Info}&nbsp;{!$Label.c.PG_AP_T_Sub_Info}
            </div>
            <div class="ap-buttons">
                <button class="apollo-btn tertiary custom-cancel"
                        onclick="{!c.doCancel}">{!$Label.c.BTN_Cancel}</button>
                <button class="apollo-btn secondary" disabled="{!!v.isValid}"
                        onclick="{!c.doSaveAndNew}">{!$Label.c.BTN_Send_and_Add_Another}</button>
                <button class="apollo-btn primary" disabled="{!!v.isValid}"
                        onclick="{!c.doSaveAndExit}">{!$Label.c.BTN_Save_and_Exit}</button>
            </div>
        </div>
        <div class="rr-width-limiter side-padding">
            <c:CommunityFooter/>
        </div>
    </aura:if>

</aura:component>