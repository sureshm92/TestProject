<!--
 - Created by Igor Malyuta on 01.03.2019.
 -->

<aura:component
    description="Manual_Task"
    implements="forceCommunity:availableForAllPageTypes,force:appHostable"
>
    <!--attributes: -->
    <aura:attribute name="parent" type="Aura.Component" />
    <aura:attribute name="wrapper" type="Object" />

    <aura:attribute name="taskConfig" type="TaskService.TaskConfig" />
    <aura:attribute name="priorities" type="List" />
    <aura:attribute name="visibility" type="List" />
    <aura:attribute name="showNumbersAdd" type="String" default="false" />
    <aura:attribute name="dayRemind" type="Integer" />
    <aura:attribute name="todayDate" type="Date" />
    <aura:attribute name="isValid" type="Boolean" default="false" />
    <aura:attribute name="recurrenceFrequency" type="List" />

    <aura:handler name="init" value="{!this}" action="{!c.doInit}" />
    <aura:handler name="change" value="{!v.taskConfig.subject}" action="{!c.doCheckFields}" />
    <aura:handler name="change" value="{!v.taskConfig.startDate}" action="{!c.doCheckFields}" />
    <aura:handler name="change" value="{!v.taskConfig.endTime}" action="{!c.doCheckFields}" />
    <aura:handler name="change" value="{!v.taskConfig.reminderDate}" action="{!c.doCheckFields}" />
    <aura:handler
        name="change"
        value="{!v.taskConfig.recurrenceFrequency}"
        action="{!c.checkRecurrence}"
    />
    <aura:handler name="change" value="{!v.dayRemind}" action="{!c.doCheckFields}" />

    <!-- component body -->
    <div class="mt-panel">
        <!-- Task Subject -->
        <lightning:input
            aura:id="field"
            label="Enter Subject"
            value="{!v.taskConfig.subject}"
            required="true"
        />
        <div class="slds-grid slds-gutters">
            <div class="slds-col slds-size--1-of-2">
                <!-- Task Priority -->
                <lightning:select
                    label="Set Priority for the Task:"
                    value="{!v.taskConfig.priority}"
                >
                    <aura:iteration items="{!v.priorities}" var="prior">
                        <option label="{!prior.label}" value="{!prior.value}"></option>
                    </aura:iteration>
                </lightning:select>
                <!-- Start Date -->
                <lightning:input
                    aura:id="field"
                    type="date"
                    label="Set Task Start Date"
                    value="{!v.taskConfig.startDate}"
                    required="true"
                    onchange="{!c.onDaysChange}"
                    min="{!v.todayDate}"
                    dateStyle="medium"
                />
                <!-- Due Date -->
                <lightning:input
                    aura:id="field"
                    type="date"
                    label="Set Task Due Date"
                    value="{!v.taskConfig.endTime}"
                    onchange="{!c.onDaysChange}"
                    min="{!v.taskConfig.startDate}"
                    disabled="{!empty(v.taskConfig.startDate)}"
                    dateStyle="medium"
                    required="{!v.taskConfig.isRecurrence}"
                />
                <!-- Recurrence -->
                <div class="recurringCheckbox">
                    <lightning:input
                        aura:id="field1"
                        type="checkbox"
                        label="Recurring Task"
                        onchange="{!c.resetTaskValues}"
                        value="{!v.taskConfig.isRecurrence}"
                        checked="{!v.taskConfig.isRecurrence}"
                        disabled="{!empty(v.taskConfig.endTime)}"
                    />
                </div>
            </div>
            <div class="slds-col slds-size--1-of-2">
                <!-- Task Visibility -->
                <lightning:select
                    label="Make this Task visible to:"
                    value="{!v.taskConfig.visibility}"
                >
                    <aura:iteration items="{!v.visibility}" var="visible">
                        <option label="{!visible.label}" value="{!visible.value}"></option>
                    </aura:iteration>
                </lightning:select>
                <!-- Reminder Mode -->
                <lightning:select
                    label="Set Task Reminder"
                    value="{!v.showNumbersAdd}"
                    disabled="{!and(v.taskConfig.recurrenceFrequency == 'Daily', v.taskConfig.isRecurrence)}"
                >
                    <aura:if isTrue="{!not(empty(v.taskConfig.endTime))}">
                        <aura:if isTrue="{!not(v.taskConfig.endTime == v.todayDate)}">
                            <option value="true">Number of days before the Task due date</option>
                        </aura:if>
                    </aura:if>
                    <aura:if isTrue="{!not(v.taskConfig.isRecurrence)}">
                        <option value="false">Specific Date</option>
                    </aura:if>
                </lightning:select>
                <aura:if isTrue="{!or(v.showNumbersAdd,v.taskConfig.isRecurrence)}">
                    <span onkeypress="{!c.dueNumberKeyPress}">
                        <lightning:input
                            aura:id="field"
                            type="number"
                            value="{!v.dayRemind}"
                            onchange="{!c.onDaysChange}"
                            min="0"
                            disabled="{!and(v.taskConfig.recurrenceFrequency == 'Daily', v.taskConfig.isRecurrence)}"
                        />
                    </span>
                    <aura:set attribute="else">
                        <lightning:input
                            aura:id="field"
                            type="date"
                            label="Reminder Date"
                            value="{!v.taskConfig.reminderDate}"
                            onchange="{!c.onDaysChange}"
                            min="{!v.taskConfig.startDate}"
                            max="{!v.taskConfig.endTime}"
                            dateStyle="medium"
                            disabled="{!and(v.taskConfig.recurrenceFrequency == 'Daily', v.taskConfig.isRecurrence)}"
                        />
                    </aura:set>
                </aura:if>
                <aura:if isTrue="{!v.taskConfig.isRecurrence}">
                    <!-- Recurrence frequency -->
                    <lightning:select
                        aura:id="field2"
                        name="select"
                        label="Recurrence Frequency"
                        required="true"
                        value="{!v.taskConfig.recurrenceFrequency}"
                    >
                        <aura:iteration items="{!v.recurrenceFrequency}" var="freq">
                            <option text="{!freq.value}" value="{!freq.value}"></option>
                        </aura:iteration>
                    </lightning:select>
                </aura:if>
            </div>
        </div>
    </div>
</aura:component>
