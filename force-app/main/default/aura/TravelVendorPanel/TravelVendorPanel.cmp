<!--
 - Created by Vitalii Aheienko on 8/27/2019.
 -->

<aura:component description="TravelVendorPanel" controller="TravelVendorPanelRemote"
                implements="force:hasRecordId, flexipage:availableForAllPageTypes" extends="c:LightningService">

    <aura:attribute name="initialized" type="Boolean" default="false"/>
    <aura:attribute name="vendorItems" type="Object[]"/>
    <aura:attribute name="currentVendorItems" type="Object[]"/>
    <aura:attribute name="selectedVendors" type="Object[]"/>
    <aura:attribute name="selectedByCountry" type="String" default=""/>
    <aura:attribute name="selectedByStudySite" type="String" default=""/>
    <aura:attribute name="currentPage" type="Integer" default="1"/>
    <aura:attribute name="permission" type="String" default=""/>

    <ltng:require scripts="{!$Resource.rr_community_js}" afterScriptsLoaded="{!c.doInit}"/>

    <aura:if isTrue="{!v.permission != 'disabled'}">
        <div class="panel" style="position: relative">
            <c:RRSpinner aura:id="spinner"/>

            <!--Filters-->
            <aura:if isTrue="{!v.initialized}">
                <div class="filters-section">
                    <div class="slds-grid slds-wrap">
                        <!--Country Filter-->
                        <div class="slds-col slds-size--6-of-12 slds-p-horizontal_medium ">
                            <c:CountryLookup
                                    aura:id="countryLookup"
                                    isMultiEntry="true"
                                    value="{!v.selectedByCountry}"
                                    onchange="{!c.getFilteredSS}"
                                    placeholder="{!$Label.c.TS_Select_Country}"
                                    placeholderSelected="{!$Label.c.TS_Select_Another_Country}"
                                    ctpId="{!v.recordId}" includeStates="false"
                                    isInclude="true"/>
                        </div>
                        <div class="slds-col slds-size--6-of-12 slds-p-horizontal_medium">
                            <c:StudySiteLookup
                                    ctpId="{!v.recordId}"
                                    isMultiEntry="true"
                                    value="{!v.selectedByStudySite}"
                                    onchange="{!c.getFilteredSS}"
                                    placeholder="{!$Label.c.TS_Select_Study_Site}"
                                    placeholderSelected="{!$Label.c.TS_Select_Another_Study_Site}"
                                    includeSS="true"/>
                        </div>
                        <div class="slds-col slds-size--6-of-12 slds-p-horizontal_medium">
                            <c:RRLookup
                                    objectName="TravelVendorSettings__c"
                                    lookupName="TravelVendor__c"
                                    selectedRecords="{!v.selectedVendors}"
                                    onchange="{!c.addVendor}"
                                    recordError=" "
                                    recordLoadError=" "
                            />
                        </div>
                        <aura:if isTrue="{! v.permission == 'edit'}">
                        <div class="slds-col slds-size--4-of-12 slds-var-m-top_x-small">
                            <lightning:button onclick="{!c.showModal}"
                                              class="slds-theme_neutral slds-m-around--medium"
                                              variant="neutral"
                                              label="{!$Label.c.TS_Add_Vendor}"/>
                        </div>
                        <c:CustomModal aura:Id='customModal' size="small">
                            <c:AddTravelVendorCmp aura:id="addTravelVendor" onSubmit="{!c.onAddTravelVendor}"/>
                            <aura:set attribute="footer">
                                <lightning:button variant="neutral" type="button" name="close"
                                                  label="{!$Label.c.BTN_Close}"
                                                  onclick="{!c.closeModal}"/>
                                <lightning:button variant="brand" type="button" name="save" label="{!$Label.c.BTN_Save}"
                                                  onclick="{!c.submitForm}"/>
                            </aura:set>
                        </c:CustomModal>
                        <!--Save changes button-->
                        <div class="slds-col slds-size--2-of-12 save-btn slds-p-horizontal_medium slds-var-m-top_x-small">
                            <lightning:button variant="brand"
                                              class="slds-m-around--medium" label="{!$Label.c.BTN_Save}"
                                              onclick="{!c.doSave}" aura:id="saveButton"/>
                        </div>
                        </aura:if>
                    </div>
                </div>
                <!--Study Site Table-->
                <div class="slds-scrollable_x">
                    <table aria-multiselectable="true"
                           class="slds-table slds-table_cell-buffer slds-table_bordered slds-table_striped" role="grid">
                        <thead>
                        <tr class="slds-line-height_reset">
                            <th class="" scope="col">
                                <div class="slds-truncate slds-text-align--center">{!$Label.c.SS_Country}</div>
                            </th>
                            <th class="" scope="col">
                                <div class="slds-truncate slds-text-align--center">{!$Label.c.Report_Study_Site}</div>
                            </th>
                            <th class="cell-wrap slds-text-align--center" scope="col">
                                <div>{!$Label.c.TS_Study_Site_Number}</div>
                            </th>
                            <aura:iteration items="{!v.selectedVendors}" var="vendor">
                                <th class="cell-wrap" scope="col">
                                    <div class="slds-medium-show--inline-block">
                                        <ui:inputCheckbox aura:id="columnVendor"
                                                          class="uiInput--checkbox slds-medium-show--inline-block slds-float--left slds-m-right--x-small slds-dl_horizontal__label"
                                                          label="{!vendor.Id}" labelClass="slds-hide"
                                                          change="{!c.columnCheckboxStateChange}"
                                                          disabled="{!v.permission == 'read'}"/>
                                        <label>{!vendor.Name}</label>
                                    </div>
                                </th>
                            </aura:iteration>
                        </tr>
                        </thead>
                        <tbody>
                        <aura:iteration items="{!v.currentVendorItems}" var="item">
                            <tr>
                                <th data-label="Country" scope="row">
                                    <div class="slds-truncate slds-text-align--center"
                                         title="">{!item.studySite.Site__r.BillingCountry}</div>
                                </th>
                                <td data-label="Study Site">
                                    <div class="slds-truncate slds-text-align--center">
                                        <a href="javascript:void(0);" onclick="{!c.navToRecord}" tabindex="-1"
                                           data-ssid="{!item.studySite.Id}">{!item.studySite.Name}</a>
                                    </div>
                                </td>
                                <td data-label="Name">
                                    <div class="slds-truncate slds-text-align--center">{!item.studySite.Study_Site_Number__c}</div>
                                </td>
                                <aura:iteration items="{!item.vendorSettings}" var="selectedVendorIdSetting">
                                    <td>
                                        <ui:inputCheckbox value="{!selectedVendorIdSetting.isEnable__c}"
                                                          label="{!selectedVendorIdSetting.Vendor__r.Name}"
                                                          disabled="{!v.permission == 'read'}"
                                                          class="uiInput--checkbox"/>
                                    </td>
                                </aura:iteration>
                            </tr>
                        </aura:iteration>
                        </tbody>
                    </table>
                    <div class="slds-align--absolute-center slds-m-around--medium">
                        <c:rrPagination aura:id="pagination" allObjects="{!v.vendorItems}" entriesOnPage="10"
                                        currentObjects="{!v.currentVendorItems}" currentPage="{!v.currentPage}"/>
                    </div>
                </div>
            </aura:if>
        </div>
    </aura:if>
</aura:component>
