<!--
 - Created by Leonid Bartenev
 -->

<aura:component description="Form_EditPatientInfo">
    <ltng:require styles="{!join(',', $Resource.rr_community_css, $Resource.proximanova + '/proximanova.css')}"
                  scripts="{!join(',', $Resource.rr_community_js)}" afterScriptsLoaded="{!c.doInit}"/>
    
    <!-- public attributes: -->
    <aura:attribute name="pe" type="Participant_Enrollment__c" access="public"/>
    <aura:attribute name="participant" type="Participant__c" access="public"/>
    <aura:attribute name="formData" type="AddPatientByPIRemote.FormData" access="public"/>
    <aura:attribute name="updateMode" type="Boolean" default="false" access="public"/>
    <aura:attribute name="isValid" type="Boolean" default="false" access="public"/>
    <aura:attribute name="isFinalUpdate" type="Boolean" default="false"/>

    <!-- private attributes: -->
    <aura:attribute name="screeningRequired" type="Boolean" default="false" access="private"/>
    <aura:attribute name="todayDate" type="Date" access="private"/>
    <aura:attribute name="statesLVList" type="LabelValueItem[]" access="private"/>
    <aura:attribute name="dataStamp" type="String"/>
    <aura:attribute name="visitPlanDisabled" type="Boolean"/>


    <!-- methods: -->
    <aura:method name="checkFields" action="{!c.doCheckFields}" access="public"/>
    <aura:method name="createDataStamp" action="{!c.doCreateDataStamp}" access="public"/>

    <!-- component body: -->
    <div>
        <!-- patient details: -->
        <div class="ap-section">
            <div class="ap-section-title">{!$Label.c.PG_AP_H_Patient_Details}</div>
            <div class="slds-grid slds-gutters slds-wrap">
                <div class="rr-form-element slds-col slds-size--1-of-1 slds-large-size--1-of-3">
                    <div class="label">
                        <abbr title="required" class="slds-required">*</abbr>{!$Label.c.PG_AS_F_First_name}
                    </div>
                    <lightning:input type="text" value="{!v.participant.First_Name__c}" required="true"
                                     onblur="{!c.doCheckFields}"/>
                </div>
                <div class="rr-form-element slds-col slds-size--1-of-1 slds-large-size--1-of-3">
                    <div class="label">{!$Label.c.PG_AS_F_Middle_name}</div>
                    <lightning:input type="text" value="{!v.participant.Middle_Name__c}"
                                     onblur="{!c.doCheckFields}"/>
                </div>
                <div class="rr-form-element slds-col slds-size--1-of-1 slds-large-size--1-of-3">
                    <div class="label"><abbr title="required"
                                             class="slds-required">*</abbr>{!$Label.c.PG_AS_F_Last_name}</div>
                    <lightning:input type="text" value="{!v.participant.Last_Name__c}" required="true"
                                     onblur="{!c.doCheckFields}"/>
                </div>
                <div class="rr-form-element slds-col slds-size--1-of-1 slds-large-size--1-of-3">
                    <div class="label"><abbr title="required"
                                             class="slds-required">*</abbr>{!$Label.c.PG_AS_F_Date_of_Birth}
                    </div>
                    <lightning:input max="{!v.todayDate}" type="date" value="{!v.participant.Date_of_Birth__c}"
                                     required="true"
                                     onblur="{!c.doCheckfields}" onchange="{!c.doCheckFields}"/>
                </div>
                <div class="rr-form-element slds-col slds-size--1-of-1 slds-large-size--1-of-3">
                    <div class="label"><abbr title="required"
                                             class="slds-required">*</abbr>{!$Label.c.PG_AS_F_Gender}</div>
                    <c:rrSelect options="{!v.formData.genderLVList}" value="{!v.participant.Gender__c}"
                                placeholder="{!$Label.c.PG_AC_Select}" required="true" useSentenceFont="false" onchange="{!c.doCheckFields}"/>
                </div>
            </div>
        </div>

        <!-- contact information: -->
        <div class="ap-section">
            <div class="ap-section-title">{!$Label.c.PG_AP_H_Contact_Information}</div>
            <div class="slds-grid slds-gutters slds-wrap">
                <div class="rr-form-element slds-col slds-size--1-of-1 slds-large-size--1-of-3">
                    <div class="label"><abbr title="required"
                                             class="slds-required">*</abbr>{!$Label.c.PG_Ref_L_Primary_daytime_telephone_number}
                    </div>
                    <lightning:input type="text" value="{!v.participant.Phone__c}" required="true"
                                     onblur="{!c.doCheckFields}"/>
                </div>
                <div class="rr-form-element slds-col slds-size--1-of-1 slds-large-size--1-of-3">
                    <div class="label"><abbr title="required"
                                             class="slds-required">*</abbr>{!$Label.c.PG_AP_F_Phone_Type}</div>
                    <c:rrSelect options="{!v.formData.phoneTypeLVList}" value="{!v.participant.Phone_Type__c}"
                                placeholder="{!$Label.c.PG_AC_Select}" required="true" onchange="{!c.doCheckFields}"/>
                </div>
                <div class="rr-form-element slds-col slds-size--1-of-1 slds-large-size--1-of-3">
                    <div class="label"><abbr title="required"
                                             class="slds-required">*</abbr>{!$Label.c.PG_AS_F_Email_address}
                    </div>
                    <lightning:input  aura:id="emailInput" type="email" value="{!v.participant.Email__c}" required="true"
                                      onblur="{!c.doCheckFields}"/>
                </div>
                <div class="rr-form-element slds-col slds-size--1-of-1 slds-large-size--1-of-3">
                    <div class="label"><abbr title="required" class="slds-required">*</abbr>{!$Label.c.PE_Country}
                    </div>
                    <c:rrSelect options="{!v.formData.countriesLVList}"
                                value="{!v.participant.Mailing_Country_Code__c}"
                                placeholder="{!$Label.c.PG_AC_Select}" required="true" useSentenceFont="false" onchange="{!c.doCheckFields}"/>
                </div>
                <div class="rr-form-element slds-col slds-size--1-of-1 slds-large-size--1-of-3">
                    <div class="label">
                        <aura:if isTrue="{!!empty(v.statesLVList)}">
                            <abbr title="required" class="slds-required">*</abbr>
                        </aura:if>{!$Label.c.PE_State}
                    </div>
                    <c:rrSelect options="{!v.statesLVList}" disabled="{!empty(v.statesLVList)}"
                                value="{!v.participant.Mailing_State_Code__c}"
                                placeholder="{!$Label.c.PG_AC_Select}" required="true" useSentenceFont="false" onchange="{!c.doCheckFields}"/>
                </div>
                <div class="rr-form-element slds-col slds-size--1-of-1 slds-large-size--1-of-3">
                    <div class="label"><abbr title="required"
                                             class="slds-required">*</abbr>{!$Label.c.PG_AS_F_Zip_Postal_Code}
                    </div>
                    <lightning:input type="text" value="{!v.participant.Mailing_Zip_Postal_Code__c}"
                                     required="true" onblur="{!c.doCheckFields}"/>
                </div>
            </div>
        </div>

        <!-- referral information -->
        <div class="ap-section">
            <div class="ap-section-title">{!$Label.c.PG_AP_H_Referral_Information}</div>
            <div class="slds-grid slds-gutters slds-wrap">
                <aura:if isTrue="{!!v.updateMode}">
                    <div class="rr-form-element slds-col slds-size--1-of-1 slds-large-size--1-of-3">
                        <div class="label"><abbr title="required"
                                                 class="slds-required">*</abbr>{!$Label.c.PG_AP_F_Patient_Status}</div>
                        <c:rrSelect options="{!v.formData.peStatusLVList}" value="{!v.pe.Participant_Status__c}"
                                    placeholder="{!$Label.c.PG_AC_Select}" required="true" useSentenceFont="false" onchange="{!c.doCheckFields}"/>
                    </div>
                </aura:if>
                <div class="rr-form-element slds-col slds-size--1-of-1 slds-large-size--1-of-3">
                    <div class="label">
                        <aura:if isTrue="{!!v.updateMode}">
                            <abbr title="required"
                                  class="slds-required">*</abbr>
                        </aura:if>
                        {!$Label.c.PG_AP_F_Referred_By}</div>
                    <c:rrSelect options="{!v.formData.referredByLVList}" value="{!v.pe.Referred_By__c}"
                                placeholder="{!$Label.c.PG_AC_Select}" required="true" useSentenceFont="false" onchange="{!c.doCheckFields}"/>
                </div>
                <div class="rr-form-element slds-col slds-size--1-of-1 slds-large-size--1-of-3">
                    <div class="label">
                        <aura:if isTrue="{!v.screeningRequired}">
                            <abbr title="required" class="slds-required">*</abbr>
                        </aura:if>
                        {!$Label.c.PG_AP_F_Screening_Subject_Id}
                    </div>
                    <lightning:input aura:id="screeningId" type="text" value="{!v.pe.Screening_ID__c}"
                                     onblur="{!c.doCheckFields}"
                                     required="{!v.screeningRequired}"/>
                </div>
                <div class="rr-form-element slds-col slds-size--1-of-1 slds-large-size--1-of-3">
                    <div class="label">{!$Label.c.MRN_Internal_Id}</div>
                    <lightning:input type="text" value="{!v.pe.MRN_Id__c}" onblur="{!c.doCheckFields}"/>
                </div>
                <div class="rr-form-element slds-col slds-size--1-of-1 slds-large-size--1-of-3">
                    <div class="label">
                        <aura:if isTrue="{!v.screeningRequired}">
                            <abbr title="required" class="slds-required">*</abbr>
                        </aura:if>Visit Plan TODO
                    </div>
                    <c:rrSelect options="{!v.formData.visitPlansLVList}" disabled="{!v.visitPlanDisabled}"
                                value="{!v.pe.Visit_Plan__c}" placeholder="{!$Label.c.PG_AC_Select}" required="{!v.screeningRequired}"
                                useSentenceFont="false" onchange="{!c.doCheckFields}"/>
                </div>

            </div>
        </div>
    </div>

</aura:component>
