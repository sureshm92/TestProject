<!--
 - Created by Leonid Bartenev
 -->

<aura:component description="ViewPatients"  implements="forceCommunity:availableForAllPageTypes" controller="ViewPatientsRemote">

    <ltng:require styles="{!join(',', $Resource.rr_community_css, $Resource.proximanova + '/proximanova.css')}"
                  scripts="{!join(',', $Resource.rr_community_js)}"
                  afterScriptsLoaded="{!c.doInit}"/>

    <!--attributes:-->
    <aura:attribute name="trialId" type="String"/>
    <aura:attribute name="siteId" type="String"/>
    <aura:attribute name="userMode" type="String"/>
    <aura:attribute name="isInitialized" type="Boolean" default="false" access="private"/>
    <aura:attribute name="emptyListMessage" type="String" access="private" default="{!$Label.c.PG_VP_L_No_Items}"/>
    <aura:attribute name="parent" type="Aura.Component"/>
    <aura:attribute name="hasEmancipatedParticipants" type="Boolean" default="false"/>

    <!--handlers:-->
    <aura:handler event="c:EventCommunityInitialized" action="{!c.doInit}"/>


    <!--component body:-->
    <c:RRSpinner aura:id="mainSpinner" size="medium" showSpinner="true" fixed="true"/>

    <div class="rr-min-body-height">
        <aura:if isTrue="{!v.isInitialized}">

            <aura:if isTrue="{!v.hasEmancipatedParticipants}">
                <div style="background: #FFF7EC; fill: white; height: 100%; color: black; line-height: 45px; font-size: 1rem; border: 0.1px solid; border-color: lightgrey;">
                    <span style="padding: 4px 16px; font-weight: 600;"><c:RRIcon iconName="warning"/> {!$Label.c.One_or_more_Participants_reached_Majority}</span>
                    <span style="text-align: right; padding: 4px 16px;"><a href="javascript:void(0);">{!$Label.c.Filter_Participant_s}</a></span>
                </div>
            </aura:if>

                <div class="vp-navigation">
                    <aura:if isTrue="{!empty(v.parent)}">
                            <aura:if isTrue="{!v.userMode == 'PI'}">
                                <div class="navigation-breadcrumbs">
                                <c:RRNavigationPath>
                                    <c:RRNPathItem label="{!$Label.c.PG_RP_L_My_Referrals}"/>
                                </c:RRNavigationPath>
                                <aura:set attribute="else">
                                    <c:RRNavigationPath>
                                        <c:RRNPathItem label="{!$Label.c.PG_VP_L_My_Patients}"/>
                                    </c:RRNavigationPath>
                                </aura:set>
                                </div>
                            </aura:if>
                        <aura:if isTrue="{!v.userMode != 'HCP'}">
                            <div class="vp-export-btn">
                                <button class="apollo-btn secondary" data-gtm="BTN_My_Participants_Export_All" onclick="{!c.doExport}">
                                        {!$Label.c.BTN_Export_All}
                                </button>
                            </div>
                        </aura:if>

                    </aura:if>
                </div>
            <aura:if isTrue="{!v.userMode == 'HCP'}">
                <c:MedicalRecordReviewLog showStatistics="false" studyFilterEnabled="true" trialId="{!v.trialId}"
                                          header="{!$Label.c.PG_MPS_L_NOT_YET_REFERRED}"/>
            </aura:if>
            <c:ViewPatientsReferred showStatistics="{!v.userMode=='PI'}" studyFilterEnabled="true" trialId="{!v.trialId}" siteId="{!v.siteId}"
                                    header="{!if(v.userMode == 'HCP',$Label.c.PG_MPS_L_REFERRED,'')}" parent="{!v.parent}"/>
        </aura:if>
    </div>
</aura:component>