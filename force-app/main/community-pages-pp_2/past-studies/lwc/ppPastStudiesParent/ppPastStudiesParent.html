<template>
    <div class="toast">
        <c-custom-toast-files-p-p is-mobile={showMenu}></c-custom-toast-files-p-p>
    </div>
    <div data-id="top"></div>
    <template if:true={showPage}>
        <div class="parent" if:false={showFilePage}>
            <div>
                <div if:true={showDetailPage} onclick={removeStudy} class="fit">
                    <span class="pointer-cursor">
                        <lightning-icon
                            icon-name="utility:chevronleft"
                            class="chevronleft-icon"
                            size="x-small"
                        ></lightning-icon>
                        <span class="back-link"> {label.Back_to_Past_Studies_and_Programs} </span>
                    </span>
                </div>
                <div if:true={showDetailPage} class="seperator-v"></div>
                <div if:false={showDetailPage} class="page-header">{pageHeader}</div>
                <div if:true={showDetailPage} class="detail-page-header">{pageHeader}</div>
                <div if:true={showDetail}>
                    <div if:false={showDetailPageSwitcher} class="set-margin"></div>
                    <div if:true={showDetailPageSwitcher}>
                        <div class="switcher" tabindex="0" onfocus={toggleSwt} onblur={toggleSwt}>
                            <div class="switcher-txt">
                                {label.PP_SwitchStudyProgram}
                                <img src={sycnDropDown} class="swt-img-size" />
                            </div>
                            <ul if:true={sectionList} class="swt-options slds-hide">
                                <template for:each={perList} for:item="per">
                                    <li key={per.Id} data-item={per.Id} onclick={selectStudy}>
                                        <span class={per.class}>
                                            {per.Clinical_Trial_Profile__r.Study_Code_Name__c}
                                        </span>
                                    </li>
                                </template>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
            <div if:true={showMenuOpt}>
                <div
                    class="dropdown"
                    data-key="dropdown"
                    tabindex="0"
                    onfocus={toggleOpt}
                    onblur={toggleOpt}
                >
                    <div class="dropdown-txt">
                        {selectedSection}
                        <span class="dropdown-img">
                            <lightning-icon
                                icon-name="utility:down"
                                class="down-icon"
                                size="x-small"
                            ></lightning-icon>
                        </span>
                    </div>
                    <ul if:true={sectionList} class="res-options slds-hide">
                        <template for:each={sectionList} for:item="section">
                            <li key={section.id} data-item={section.id} onclick={sectionChange}>
                                <span class={section.class}>{section.id}</span>
                            </li>
                        </template>
                    </ul>
                </div>
            </div>
            <div
                if:false={showDetailPage}
                class="slds-align-content-center slds-grid slds-wrap main-overview"
            >
                <template for:each={perList} for:item="per">
                    <div
                        key={per.Id}
                        data-item={per.Id}
                        class="slds-large-size--3-of-5 slds-size--1-of-1 box-container"
                        onclick={selectStudy}
                    >
                        <span class="no-click">
                            <c-pp-past-studies-overview
                                main-class="tiles container-overview"
                                per={per}
                            ></c-pp-past-studies-overview>
                        </span>
                    </div>
                </template>
            </div>

            <div if:false={hideDetailPage}>
                <div if:true={showDetailPage} class="slds-grid slds-wrap">
                    <div
                        if:true={showOverview}
                        class="slds-size--1-of-1 slds-grid slds-wrap contTable"
                    >
                        <div class="slds-large-size--3-of-5 slds-size--1-of-1 contTableCell">
                            <div class="box-header">{label.PP_Overview}</div>
                            <div class="box-container">
                                <c-pp-past-studies-overview
                                    main-class="detail container-overview"
                                    per={selectedPER}
                                ></c-pp-past-studies-overview>
                            </div>
                        </div>
                        <div
                            class="slds-large-size--2-of-5 slds-size--1-of-1 box-right contTableCell"
                        >
                            <div class="box-header slds-hidden">.</div>
                            <div
                                class="box-container sectionHeight slds-align--absolute-center slds-grid slds-wrap partComplete-container"
                            >
                                <div class="slds-size--1-of-1 partComplete-img">
                                    <img src={winnersIcon} />
                                </div>
                                <div class="slds-size--1-of-1 partComplete-title">
                                    {label.Your_participation_is_complete}
                                </div>
                                <div class="slds-size--1-of-1 partComplete-text">
                                    {label.Participation_complete_description}
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class={docFileClass}>
                        <template
                            if:true={selectedPER.Clinical_Trial_Profile__r.Study_Documents_Are_Available__c}
                        >
                            <div if:true={showDoc} class={docContClass}>
                                <div class="box-header">{label.PP_Resource_Documents}</div>
                                <div class="box-container doc-box">
                                    <!-- <div class="slds-size--1-of-1 no-doc-img"><img src={noDocsIcon}/></div>
                                <div class="slds-size--1-of-1 no-doc-txt">{label.No_Documents_Available}</div> -->
                                    <c-pp-past-studies-documents
                                        lazy-load={showMenu}
                                        pe={selectedPER}
                                    ></c-pp-past-studies-documents>
                                </div>
                            </div>
                        </template>
                        <div if:true={showFiles} class={fileContClass}>
                            <div class="box-header file-header">{label.PP_MyFiles}</div>
                            <div class="pir-parent pastStudiesFiles">
                                <lightning-tabset class="all-tabs">
                                    <lightning-tab label="Uploaded" onactive={handleFiles}>
                                        <div class={uploadedFilesClass}>
                                            <div class="box-container file-box">
                                                <c-pp-past-studies-my-files
                                                    onfiledeleted={showdeletetoast}
                                                    study={selectedPER.Clinical_Trial_Profile__c}
                                                    cont-id={contID}
                                                    file-uploaded="true"
                                                    class={uploadedFilesClass}
                                                    onmorefiles={showViewMore}
                                                ></c-pp-past-studies-my-files>
                                            </div>
                                            <div class="card-link slds-align_absolute-center">
                                                <span onclick={viewFile}>View All Files</span>
                                            </div>
                                        </div>
                                    </lightning-tab>
                                    <lightning-tab
                                        label="Shared with Me"
                                        onactive={handleMessageFiles}
                                    >
                                        <div class={sharedFilesClass}>
                                            <div class="box-container file-box">
                                                <c-pp-past-studies-my-files
                                                    pe-id={selectedPER.Id}
                                                    onmorefiles={showViewMore}
                                                    class={sharedFilesClass}
                                                ></c-pp-past-studies-my-files>
                                            </div>
                                            <div class="card-link slds-align_absolute-center">
                                                <span onclick={viewFile}>View All Files</span>
                                            </div>
                                        </div>
                                    </lightning-tab>
                                </lightning-tabset>
                            </div>
                        </div>
                    </div>
                    <div class={bottonRightBoxClass}>
                        <template
                            if:true={selectedPER.Clinical_Trial_Profile__r.Visit_Data_Shareback__c}
                        >
                            <div if:true={showResults} class="slds-size--1-of-1">
                                <div class="box-header">
                                    {label.Visit_Results_Dashboard_My_Results}
                                </div>
                                <div
                                    class="box-container slds-align--absolute-center slds-grid slds-wrap small-box"
                                >
                                    <c-pp-past-studies-result
                                        perid={selectedPER.Id}
                                        studyid={selectedPER.Clinical_Trial_Profile__c}
                                    ></c-pp-past-studies-result>
                                </div>
                            </div>
                        </template>
                        <div if:true={showComm} class="slds-size--1-of-1">
                            <div class="box-header">{label.PP_Care_Team_Contact}</div>
                            <div class="box-container small-box contact-box">
                                <div class=" ">
                                    <div class="con-header">{label.PP_Phone_In_Caps}</div>
                                    <template
                                        if:false={selectedPER.Study_Site__r.Study_Site_Phone__c}
                                    >
                                        <div class="con-not-available">
                                            {label.PP_Visit_Result_Value_Not_Available}
                                        </div>
                                    </template>
                                    <template
                                        if:true={selectedPER.Study_Site__r.Study_Site_Phone__c}
                                    >
                                        <div class="con-available">
                                            <span class="con-txt-align my-class">
                                                {selectedPER.Study_Site__r.Study_Site_Phone__c}
                                            </span>
                                            <span
                                                class="copyIcon"
                                                onclick={copyEmailPhone}
                                                data-id={selectedPER.Study_Site__r.Study_Site_Phone__c}
                                            >
                                                <svg
                                                    xmlns="http://www.w3.org/2000/svg"
                                                    height="20"
                                                    width="18"
                                                    class="copy-icon no-click"
                                                >
                                                    <use xlink:href={copyIconUrl}></use>
                                                </svg>
                                                <img src={copiedIcon} class="copied no-click" />
                                            </span>
                                        </div>
                                    </template>
                                </div>
                                <div class="con-m-top">
                                    <div class="con-header">{label.PP_EMAIL_caps}</div>
                                    <template
                                        if:false={selectedPER.Study_Site__r.Study_Site_Email__c}
                                    >
                                        <div class="con-not-available">
                                            {label.PP_Visit_Result_Value_Not_Available}
                                        </div>
                                    </template>
                                    <template
                                        if:true={selectedPER.Study_Site__r.Study_Site_Email__c}
                                    >
                                        <div class="con-available">
                                            <span class="con-txt-align">
                                                {selectedPER.Study_Site__r.Study_Site_Email__c}
                                            </span>
                                            <span
                                                class="copyIcon"
                                                onclick={copyEmailPhone}
                                                data-id={selectedPER.Study_Site__r.Study_Site_Email__c}
                                            >
                                                <svg
                                                    xmlns="http://www.w3.org/2000/svg"
                                                    height="20"
                                                    width="18"
                                                    class="copy-icon no-click"
                                                >
                                                    <use xlink:href={copyIconUrl}></use>
                                                </svg>
                                                <img src={copiedIcon} class="copied no-click" />
                                            </span>
                                        </div>
                                    </template>
                                </div>
                            </div>
                        </div>
                        <template if:true={selectedPER.Study_Site__r.Messages_Are_Available__c}>
                            <div if:true={showComm} class="slds-size--1-of-1">
                                <div class="box-header">{label.PP_Past_Messages}</div>
                                <div class="box-container small-box">
                                    <c-pp-past-studies-past-messages
                                        per={selectedPER}
                                        no-messages-icon={noMessagesIcon}
                                        contactid={contID}
                                    ></c-pp-past-studies-past-messages>
                                </div>
                            </div>
                        </template>
                    </div>
                </div>
            </div>
        </div>
    </template>
    <template if:true={showFilePage}>
        <c-pp-past-studies-files
            per-id={selectedPER.Id}
            onloaddetail={slectStudyFormFiles}
        ></c-pp-past-studies-files>
    </template>
</template>
