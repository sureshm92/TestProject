image: salesforce/salesforcedx:7.82.1-0-full
stages:

  #Validation:
  - SonarCheck
  - VALIDATE
 
#6.4 INT
  - DeployINT6.4
  - RunTestINT6.4
  
#6.4 INF
  - DeployINF6.4
  - RunTestINF6.4

cache:
  paths:
    - ~/.sfdx
    - .sfdx


# Validation: ------------------------------------------------------------------
SonarCheck:
  allow_failure: true
  tags:
    - RHPP
  only:
   - merge_requests
  except:
   - push
   - commit
  stage: SonarCheck
  image:
    name: sonarsource/sonar-scanner-cli:latest
    entrypoint: [""]
  cache:
    key: "${CI_JOB_NAME}"
    paths:
      - .sonar/cache
  before_script:
   - echo "Sonar Analysis"
  script:
   - . ./scripts/ci/sonar-check.sh


VALIDATE:
  tags:
    - RHPP
  only:
    - merge_requests
  except:
    - push
    - commit

  stage: VALIDATE
  script:
    - . ./scripts/ci/validate.sh INF64

    # 6.4 INT: ---------------------------------------------------------------------
DeployINT6.4:
  #tags:
   # - shell
  only:
    - Optimization
  except:
    - merge_requests

  stage: DeployINT6.4
  script:
    - . ./scripts/ci/deploy.sh INT64

RunTestINT6.4:
  #tags:
   # - shell
  only:
    - Optimization
  except:
    - merge_requests

  stage: RunTestINT6.4
  script:
    - . ./scripts/ci/run-tests.sh INT64
    
     # 6.2 INT: ---------------------------------------------------------------------
DeployINF6.4:
  #tags:
   # - shell
  only:
    - INF6.4
  except:
    - merge_requests

  stage: DeployINF6.4
  script:
    - . ./scripts/ci/deploy.sh INF64

RunTestINF6.4:
  #tags:
   # - shell
  only:
    - INF6.4
  except:
    - merge_requests

  stage: RunTestINF6.4
  script:
    - . ./scripts/ci/run-tests.sh INF64