<!--
 - Created by Vitalii Aheienko on 8/27/2019.
 -->

<aura:component description="TravelVendorPanel" controller="TravelVendorPanelRemote"
                implements="force:hasRecordId, flexipage:availableForAllPageTypes">

    <aura:attribute name="initialized" type="Boolean" default="false"/>
    <aura:attribute name="countryCodes" type="String"/>
    <aura:attribute name="countryFilterType" type="String" default="All"/>
    <aura:attribute name="selectedCountryCodes" type="String"/>
    <aura:attribute name="selectedByCountrySSIds" type="Object[]"/>
    <aura:attribute name="selectedManuallySSIds" type="String"/>
    <aura:attribute name="vendorItems" type="Object[]"/>
    <aura:attribute name="selectedVendors" type="Object[]"/>

    <ltng:require scripts="{!$Resource.rr_community_js}" afterScriptsLoaded="{!c.doInit}"/>


    <div class="panel">
        <c:RRSpinner aura:id="spinner"/>

        <!--Filters-->
        <aura:if isTrue="{!v.initialized}">
            <div class="filters-section">
                <div class="slds-grid slds-wrap">
                    <!--Country Filter-->
                    <div class="slds-col slds-size--6-of-12 slds-p-horizontal_medium ">
                        <c:VisitResultSharingCountryLookup
                                aura:id="countryLookup"
                                isMultiEntry="true"
                                value="{!v.countryCodes}"
                                onchange="{!c.getFilteredSS}"
                                placeholder="{!$Label.c.TS_Select_Country}"
                                placeholderSelected="{!$Label.c.TS_Select_Another_Country}"
                                ctpId="{!v.recordId}" includeStates="false"
                                isInclude="true"/>
                    </div>
                    <div class="slds-col slds-size--6-of-12 slds-p-horizontal_medium">
                        <c:VisitResultSharingSSLookup
                                ctpId="{!v.recordId}"
                                isMultiEntry="true"
                                value="{!v.selectedManuallySSIds}"
                                onchange="{!c.getFilteredSS}"
                                placeholder="{!$Label.c.TS_Select_Study_Site}"
                                placeholderSelected="{!$Label.c.TS_Select_Another_Study_Site}"
                                includeSS="true"/>
                    </div>
                    <div class="slds-col slds-size--6-of-12 slds-p-horizontal_medium">
                        <c:RRLookup
                                objectName="TravelVendorSettings__c"
                                lookupName="TravelVendor__c"
                                selectedRecords="{!v.selectedVendors}"
                                onchange="{!c.addVendor}"
                        />
                    </div>
                    <div class="slds-col slds-size--4-of-12 slds-var-m-top_x-small">
                        <lightning:button onclick="{!c.showModal}"
                                          class="slds-theme_neutral slds-m-around--medium"
                                          variant="neutral"
                                          label="{!$Label.c.TS_Add_Vendor}"/>
                    </div>
                    <c:CustomModal aura:Id='customModal' size="small">
                        <c:AddTravelVendorCmp aura:id="addTravelVendor" onSubmit="{!c.onAddTravelVendor}"/>
                        <aura:set attribute="footer">
                            <lightning:button variant="neutral" type="button" name="close" label="{!$Label.c.BTN_Close}"
                                              onclick="{!c.closeModal}"/>
                            <lightning:button variant="brand" type="button" name="save" label="{!$Label.c.BTN_Save}"
                                              onclick="{!c.submitForm}"/>
                        </aura:set>
                    </c:CustomModal>
                    <!--Save changes button-->
                    <div class="slds-col slds-size--2-of-12 save-btn slds-p-horizontal_medium slds-var-m-top_x-small">
                        <lightning:button variant="brand"
                                          class="slds-m-around--medium" label="{!$Label.c.BTN_Save}"
                                          onclick="{!c.doSave}"/>
                    </div>
                </div>
            </div>
            <!--Study Site Table-->
            <div class="slds-scrollable_x">
                <table aria-multiselectable="true"
                       class="slds-table slds-table_cell-buffer slds-table_bordered slds-table_striped" role="grid">
                    <thead>
                    <tr class="slds-line-height_reset">
                        <th class="" scope="col">
                            <div class="slds-truncate slds-text-align--center">{!$Label.c.SS_Country}</div>
                        </th>
                        <th class="" scope="col">
                            <div class="slds-truncate slds-text-align--center">{!$Label.c.Report_Study_Site}</div>
                        </th>
                        <th class="cell-wrap" scope="col">
                            <div>{!$Label.c.TS_Study_Site_Number}</div>
                        </th>
                        <aura:iteration items="{!v.selectedVendors}" var="vendor">
                            <th class="cell-wrap" scope="col">
                                <div class="slds-medium-show--inline-block">
                                    <ui:inputCheckbox aura:id="columnLang" class="slds-medium-show--inline-block slds-float--left slds-m-right--x-small slds-dl_horizontal__label" label="{!vendor.Name}" text="{!vendor.Id}"
                                                      change="{!c.columnCheckboxStateChange}"/>
<!--                                    <label class="slds-medium-show&#45;&#45;inline-block"> {!vendor.Name}</label>-->
                                </div>
                            </th>
                        </aura:iteration>
                    </tr>
                    </thead>
                    <tbody>
                    <aura:iteration items="{!v.vendorItems}" var="item">
                        <tr>
                            <th data-label="Country" scope="row">
                                <div class="slds-truncate slds-text-align--center"
                                     title="">{!item.studySite.Site__r.BillingCountry}</div>
                            </th>
                            <td data-label="Study Site">
                                <div class="slds-truncate slds-text-align--center">
                                    <a href="javascript:void(0);" onclick="{!c.navToRecord}" tabindex="-1"
                                       data-ssid="{!item.studySite.Id}">{!item.studySite.Name}</a>
                                </div>
                            </td>
                            <td data-label="Name">
                                <div class="slds-truncate slds-text-align--center">{!item.studySite.Study_Site_Number__c}</div>
                            </td>
                            <aura:iteration items="{!item.vendorSettings}" var="selectedVendorIdSetting">
                                <td>
                                    <ui:inputCheckbox value="{!selectedVendorIdSetting.isEnable__c}" label="{!selectedVendorIdSetting.Vendor__r.Name}"/>
                                </td>
                            </aura:iteration>
                        </tr>
                    </aura:iteration>
                    </tbody>
                </table>
            </div>
        </aura:if>
    </div>

</aura:component>
