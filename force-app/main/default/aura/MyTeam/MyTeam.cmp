<aura:component controller="MyTeamRemote" description="MyTeam">

    <ltng:require styles="{!join(',', $Resource.rr_community_css, $Resource.proximanova + '/proximanova.css')}"
                  scripts="{!join(',', $Resource.rr_community_js)}"/>

    <!-- attributes: -->
    <aura:attribute name="userMode" type="String" description="HCP / PI / Participant"/>
    <aura:attribute name="isInitialized" type="Boolean" default="false"/>
    <aura:attribute name="showSpinner" type="Boolean" default="true" access="private"/>
    <aura:attribute name="isModalOpen" type="Boolean" default="false" access="private"/>
    <aura:attribute name="childComponent" type="Aura.Component"
                    description="PatientDelegateItem set this attribute for identification"/>
    <aura:attribute name="delegates" type="List" access="private"/>
    <aura:attribute name="delegateOptions" type="List" access="private"/>
    <aura:attribute name="hasStudies" type="Boolean" access="private"/>
    <aura:attribute name="saveInProgress" type="Boolean" default="false"/>

    <!-- methods: -->
    <aura:method name="refresh" action="{!c.doInit}" access="public"/>
    <aura:method name="showRemoveModal" action="{!c.openModal}" access="public"/>

    <!-- handlers: -->
    <aura:handler name="init" value="{!this}" action="{!c.doInit}"/>
    <aura:handler event="c:EventCommunityInitialized" action="{!c.doInit}"/>

    <!--component body-->
    <div class="mt-container">
        <c:RRSpinner aura:id="mainSpinner" size="medium" showSpinner="{!v.showSpinner}"/>
        <c:Action_SaveDelegateLevelChanges aura:id="saveDelegateLevelChanges" saveInProgress="{!v.saveInProgress}"
                                           userMode="{!v.userMode}"/>
        <div class="slds-grid slds-wrap slds-gutters">
            <div class="slds-col slds-size_1-of-1 slds-medium-size_4-of-12 slds-order_2 slds-medium-order_1">
                <div class="mt-button-container">
                    <button class="apollo-btn primary mt-button" onclick="{!c.inviteTeamMembers}"
                            title="{!if(v.hasStudies,'',$Label.c.PG_MT_T_Your_permissions_do_not_permit_this_action)}"
                            disabled="{!not(v.hasStudies)}">
                        {!if(v.userMode == 'Participant',$Label.c.PG_PST_L_Delegates_Add,$Label.c.PG_MT_BTN_Add_New_Team_Member)}
                    </button>
                </div>
                <div class="delegate-info-table-container">
                    <c:DelegateLevelInfoTable userMode="{!v.userMode}"/>
                </div>
                <c:DelegatesDisclaimer/>
            </div>
            <aura:if isTrue="{!and(v.userMode == 'Participant', v.delegates.length == 0)}">
                <div class="slds-col slds-size_1-of-1 slds-order_1 slds-medium-order_2 empty-list">
                    {!$Label.c.PG_PST_L_Delegates_Click_Add_New}
                </div>
                <aura:set attribute="else">
                    <div class="slds-col slds-size_1-of-1 slds-medium-size_8-of-12 slds-order_1 slds-medium-order_2 team-items-panel">
                        <aura:iteration items="{!v.delegates}" var="delegate">
                            <aura:if isTrue="{!v.userMode != 'Participant'}">
                                <c:MyTeamItem delegate="{!delegate}"
                                              userMode="{!v.userMode}"
                                              parentComponent="{!this}"
                                              options="{!v.delegateOptions}"
                                              saveInProgress="{!v.saveInProgress}"/>
                                <aura:set attribute="else">
                                    <c:PatientDelegateItem delegate="{!delegate}" parentComponent="{!this}"/>
                                    <!--Modal for remove patient delegate-->
                                    <aura:if isTrue="{!v.isModalOpen}">
                                        <section role="dialog" tabindex="-1" aria-labelledby="modal-heading-01"
                                                 aria-modal="true"
                                                 aria-describedby="modal-content-id-1"
                                                 class="slds-modal slds-fade-in-open">
                                            <div class="slds-modal__container">
                                                <header class="slds-modal__header modal-header">
                                                    <h2 id="modal-heading-01"
                                                        class="slds-text-heading_medium slds-hyphenate">
                                                        {!$Label.c.PG_PST_L_Delegates_Remove_Delegate}
                                                    </h2>
                                                </header>
                                                <div class="slds-modal__content" id="modal-content-id-1">
                                                    <p class="modal-text">
                                                        {!$Label.c.PG_PST_L_Delegates_Remove_Mess_P1 + ' ' +
                                                        delegate.delegateContact.FirstName + ' ' +
                                                        $Label.c.PG_PST_L_Delegates_Remove_Mess_P2}
                                                    </p>
                                                    <div class="slds-grid slds-gutters">
                                                        <div class="slds-col">
                                                            <lightning:button
                                                                    class="slds-button slds-button_brand modal-button"
                                                                    aura:id="confirmButton" label="Yes"
                                                                    onclick="{!c.openModal}"/>
                                                        </div>
                                                        <div class="slds-col">
                                                            <lightning:button
                                                                    class="slds-button slds-button_neutral modal-button"
                                                                    label="No" onclick="{!c.openModal}"/>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </section>
                                        <div class="slds-backdrop slds-backdrop_open"></div>
                                    </aura:if>
                                </aura:set>
                            </aura:if>
                        </aura:iteration>
                    </div>
                </aura:set>
            </aura:if>
        </div>
    </div>
</aura:component>