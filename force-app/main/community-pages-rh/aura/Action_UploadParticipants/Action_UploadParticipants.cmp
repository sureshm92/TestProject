<!--
 - Created by alekseymoseev on 12/10/19.
 -->

<aura:component description="Action_UploadParticipants" controller="Action_UploadParticipantsRemote">

    <ltng:require scripts="{!$Resource.jszip}"/>
    <ltng:require scripts="{!$Resource.xlsxmin}"/>

    <aura:attribute name="FileList" type="Object"/>
    <aura:attribute name="participantStatuses" type="List"/>
    <aura:attribute name="selectedStatus" type="String"/>
    <aura:attribute name="studySiteId" type="String"/>
    <aura:attribute name="reqFieldsFilled" type="Boolean"/>
    <aura:attribute name="fileName" type="String"/>
    <aura:attribute name="fileType" type="String"/>
    <aura:attribute name="fileBody" type="String"/>
    <aura:attribute name="fullFileName" type="String"/>

    <!-- methods:-->
    <aura:method name="execute" action="{!c.doExecute}" access="public">
        <aura:attribute name="studySiteId" type="String"/>
        <aura:attribute name="callback" type="Function"/>
    </aura:method>


    <div class="mrc-invite-popup">
        <c:Popup aura:id="uploadParticipantsDialog" title="{!$Label.c.SS_Upload_Participants}" size="medium">
            <c:RRSpinner aura:id="upModalSpinner" size="medium" showSpinner="false"/>
            <div class="slds-grid slds-grid_vertical">
                <div class="slds-grid slds-wrap slds-scrollable">
                    <div class="slds-size_1-of-1 slds-p-horizontal_x-medium">
                        <div class="slds-m-around--small">
                            <div class="input-fields-labels"><abbr class="slds-required" title="required">* </abbr><b>Add File:</b><span style="float: right;"><ui:outputURL aura:id="oURL" value="{!$Resource.PARTICIPANTS_TEMPLATE}" label="Download Template"/></span></div>
                        </div>
                    </div>
                </div>
                <div class="slds-grid slds-wrap slds-scrollable">
                    <div class="slds-size_2-of-2 slds-p-horizontal_x-medium">
                        <div class="slds-m-around--small" data-gtm="pnl_UploadNewParticipants_importFile">
                            <div class="input-fields-labels" style="color: blue;">
                                {!v.fullFileName}
                                <aura:if isTrue="{!!empty(v.fullFileName)}">
                                    <a href="javascript:void(0)" onclick="{!c.doClearFile}">
                                        <c:RRIcon color="blue" iconName="icon-close"/>
                                    </a>
                                </aura:if>
                            </div>
                            <lightning:input aura:id="file-input" type="file" files="{!v.FileList}" accept=".xls, .xlsx, .csv"
                                             name="file" multiple="false" onchange="{!c.upload}"/>
                        </div>
                    </div>
                </div>
                <div class="slds-grid slds-wrap slds-scrollable">
                    <div class="slds-size_2-of-2 slds-p-horizontal_x-medium">
                        <div class="slds-m-around--small">
                            <div class="input-fields-labels"><b>{!$Label.c.PG_AP_F_Patient_Status_Select}</b></div>
                        </div>
                    </div>
                </div>
                <div class="slds-grid slds-wrap slds-scrollable">
                    <div class="slds-size_1-of-1 slds-p-horizontal_x-medium">
                        <div class="slds-m-around--small" data-gtm="pnl_UploadNewParticipants_status">
                            <div class="input-fields-labels"><abbr class="slds-required" title="required">* </abbr>{!$Label.c.PG_AP_F_Patient_Status}</div>
                            <c:rrSelect id="statusesPicklist"
                                        options="{!v.participantStatuses}"
                                        value="{!v.selectedStatus}"
                                        class="delegate-select"
                                        placeholder="{!$Label.c.PG_AC_Select}"
                                        useSentenceFont="false"/>
                        </div>
                    </div>
                </div>
            </div>

            <aura:set attribute="footerButtons">
                <div class="slds-grid slds-wrap">
                    <div class="slds-col slds-size--7-of-12 slds-max-small-size--1-of-1 slds-grid slds-grid--vertical-align-center">
                        <lightning:input type="checkbox" class="invite-patient-checkbox" checked="{!v.sendEmails}"/>
                        <div class="slds-size--10-of-12">Participant included in this file have consented to receiving an invitation to the Patient Portal.
                        </div>
                    </div>
                    <div class="slds-col slds-size--5-of-12">
                    <button class="apollo-btn secondary" data-gtm="btn_UploadNewParticipants_cancel"
                            onclick="{!c.doCancel}">
                        {!$Label.c.BTN_Cancel}
                    </button>
                    <button class="apollo-btn primary" onclick="{!c.doImport}"
                            data-gtm="btn_UploadNewParticipants_import"
                            disabled="{!empty(v.selectedStatus)||empty(v.fileName)}"
                            title="{!empty(v.selectedStatus)||empty(v.fileName) ? $Label.c.PG_MRC_RF_Not_all_Req_Fields : ''}">
                        {!$Label.c.BTN_Import}
                    </button>
                    </div>
                </div>
            </aura:set>

        </c:Popup>
    </div>

</aura:component>